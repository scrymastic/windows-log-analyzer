detection:
- selection:
  - and:
    - TargetObject|contains: \CLSID\
    - TargetObject|endswith: \InprocServer32\(Default)
- filter_main_generic:
  - and:
    - or:
      - Details|contains: '%%systemroot%%\system32\'
      - Details|contains: '%%systemroot%%\SysWow64\'
- filter_main_onedrive:
  - and:
    - or:
      - Details|contains: \AppData\Local\Microsoft\OneDrive\
      - Details|contains: \FileCoAuthLib64.dll
      - Details|contains: \FileSyncShell64.dll
      - Details|contains: \FileSyncApi64.dll
- filter_main_health_service:
  - and:
    - Image|endswith: :\WINDOWS\system32\SecurityHealthService.exe
- filter_main_teams:
  - and:
    - Details|contains: \AppData\Local\Microsoft\TeamsMeetingAddin\
    - Details|contains: \Microsoft.Teams.AddinLoader.dll
- filter_main_dropbox:
  - and:
    - Details|contains: \AppData\Roaming\Dropbox\
    - Details|contains: \DropboxExt64.*.dll
- filter_main_trend_micro:
  - and:
    - Details|endswith: TmopIEPlg.dll
- filter_main_update:
  - and:
    - or:
      - Image|endswith: :\WINDOWS\system32\wuauclt.exe
      - Image|endswith: :\WINDOWS\system32\svchost.exe
- filter_main_defender:
  - and:
    - or:
      - Image|contains: :\ProgramData\Microsoft\Windows Defender\Platform\
      - Image|contains: :\Program Files\Windows Defender\
    - Image|endswith: \MsMpEng.exe
- filter_main_nvidia:
  - and:
    - Details|contains: \FileRepository\nvmdi.inf
- filter_main_edge:
  - and:
    - Image|endswith: \MicrosoftEdgeUpdateComRegisterShell64.exe
- filter_main_dx:
  - and:
    - Image|endswith: :\WINDOWS\SYSTEM32\dxdiag.exe
- filter_main_python:
  - and:
    - or:
      - Details|endswith: :\Windows\pyshellext.amd64.dll
      - Details|endswith: :\Windows\pyshellext.dll
- filter_main_bonjourlib:
  - and:
    - or:
      - Details|endswith: :\Windows\system32\dnssdX.dll
      - Details|endswith: :\Windows\SysWOW64\dnssdX.dll
- filter_main_printextensionmanager:
  - and:
    - Details|endswith: :\Windows\system32\spool\drivers\x64\3\PrintConfig.dll
- filter_main_programfiles:
  - and:
    - or:
      - Details|contains: :\Program Files\
      - Details|contains: :\Program Files (x86)\
- filter_main_programdata:
  - and:
    - Details|contains: :\ProgramData\Microsoft\
- filter_main_gameservice:
  - and:
    - Details|contains: :\WINDOWS\system32\GamingServicesProxy.dll
- filter_main_poqexec:
  - and:
    - Image|endswith: :\Windows\System32\poqexec.exe
    - Details|contains: :\Windows\System32\Autopilot.dll
- filter_main_sec_health_svc:
  - and:
    - Image|endswith: :\Windows\system32\SecurityHealthService.exe
    - Details|contains: :\Windows\System32\SecurityHealth
- filter_main_inprocserver:
  - and:
    - or:
      - Image|endswith: :\Windows\System32\poqexec.exe
      - Image|endswith: :\Windows\System32\regsvr32.exe
    - TargetObject|endswith: \InProcServer32\(Default)
- condition: selection and not 1 of filter_main_*
id: a0ff33d8-79e4-4cef-b4f3-9dc4133ccd12
logsource:
  category: registry_set
  product: windows
