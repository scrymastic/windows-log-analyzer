detection:
- and:
  - TargetObject|contains: \Software\Classes
  - or:
    - TargetObject|contains: \Folder\ShellEx\ExtShellFolderViews
    - TargetObject|contains: \Folder\ShellEx\DragDropHandlers
    - TargetObject|contains: \Folder\Shellex\ColumnHandlers
    - TargetObject|contains: \Filter
    - TargetObject|contains: \Exefile\Shell\Open\Command\(Default)
    - TargetObject|contains: \Directory\Shellex\DragDropHandlers
    - TargetObject|contains: \Directory\Shellex\CopyHookHandlers
    - TargetObject|contains: \CLSID\{AC757296-3522-4E11-9862-C17BE5A1767E}\Instance
    - TargetObject|contains: \CLSID\{ABE3B9A4-257D-4B97-BD1A-294AF496222E}\Instance
    - TargetObject|contains: \CLSID\{7ED96837-96F0-4812-B211-F13C24117ED3}\Instance
    - TargetObject|contains: \CLSID\{083863F1-70DE-11d0-BD40-00A0C911CE86}\Instance
    - TargetObject|contains: \Classes\AllFileSystemObjects\ShellEx\DragDropHandlers
    - TargetObject|contains: \.exe
    - TargetObject|contains: \.cmd
    - TargetObject|contains: \ShellEx\PropertySheetHandlers
    - TargetObject|contains: \ShellEx\ContextMenuHandlers
  - or:
    - Details|!==: (Empty)
  - or:
    - Details|!==: '{807583E5-5146-11D5-A672-00B0D022E945}'
  - or:
    - Image|!==: C:\Windows\System32\drvinst.exe
  - or:
    - Image|!==: C:\Windows\System32\svchost.exe
    - TargetObject|not contains: \lnkfile\shellex\ContextMenuHandlers\
id: 9df5f547-c86a-433e-b533-f2794357e242
