detection:
- selection_shadow:
  - and:
    - or:
      - TargetObject|contains: \Control\Terminal Server\
      - TargetObject|contains: \Windows NT\Terminal Services\
    - TargetObject|endswith: \Shadow
    - or:
      - Details|==: DWORD (0x00000001)
      - Details|==: DWORD (0x00000002)
      - Details|==: DWORD (0x00000003)
      - Details|==: DWORD (0x00000004)
- selection_terminal_services_key:
  - and:
    - or:
      - TargetObject|contains: \Control\Terminal Server\
      - TargetObject|contains: \Windows NT\Terminal Services\
    - or:
      - TargetObject|endswith: \DisableRemoteDesktopAntiAlias
      - TargetObject|endswith: \DisableSecuritySettings
      - TargetObject|endswith: \fAllowUnsolicited
      - TargetObject|endswith: \fAllowUnsolicitedFullControl
    - Details|==: DWORD (0x00000001)
- selection_tamper_only:
  - and:
    - or:
      - TargetObject|contains: \Control\Terminal Server\InitialProgram
      - TargetObject|contains: \Control\Terminal Server\WinStations\RDP-Tcp\InitialProgram
      - TargetObject|contains: \services\TermService\Parameters\ServiceDll
      - TargetObject|contains: \Windows NT\Terminal Services\InitialProgram
- condition: selection_shadow or selection_terminal_services_key or selection_tamper_only
id: 3f6b7b62-61aa-45db-96bd-9c31b36b653c
logsource:
  category: registry_set
  product: windows
