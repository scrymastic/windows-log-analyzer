detection:
- selection_schtasks:
  - and:
    - Image|endswith: \schtasks.exe
    - CommandLine|contains: '/Create '
- selection_pattern_1:
  - and:
    - or:
      - CommandLine|contains: '/sc minute '
      - CommandLine|contains: '/ru system '
- selection_pattern_2:
  - and:
    - or:
      - CommandLine|contains: cmd /c
      - CommandLine|contains: cmd /k
      - CommandLine|contains: cmd /r
      - CommandLine|contains: 'cmd.exe /c '
      - CommandLine|contains: 'cmd.exe /k '
      - CommandLine|contains: 'cmd.exe /r '
- selection_uncommon:
  - and:
    - or:
      - CommandLine|contains: ' -decode '
      - CommandLine|contains: ' -enc '
      - CommandLine|contains: ' -w hidden '
      - CommandLine|contains: ' bypass '
      - CommandLine|contains: ' IEX'
      - CommandLine|contains: .DownloadData
      - CommandLine|contains: .DownloadFile
      - CommandLine|contains: .DownloadString
      - CommandLine|contains: '/c start /min '
      - CommandLine|contains: FromBase64String
      - CommandLine|contains: mshta http
      - CommandLine|contains: mshta.exe http
- selection_anomaly_1:
  - and:
    - or:
      - CommandLine|contains: :\ProgramData\
      - CommandLine|contains: :\Temp\
      - CommandLine|contains: :\Tmp\
      - CommandLine|contains: :\Users\Public\
      - CommandLine|contains: :\Windows\Temp\
      - CommandLine|contains: \AppData\
      - CommandLine|contains: '%AppData%'
      - CommandLine|contains: '%Temp%'
      - CommandLine|contains: '%tmp%'
- selection_anomaly_2:
  - and:
    - or:
      - CommandLine|contains: cscript
      - CommandLine|contains: curl
      - CommandLine|contains: wscript
- condition: selection_schtasks and ( all of selection_pattern_* or selection_uncommon
    or all of selection_anomaly_* )
id: f2c64357-b1d2-41b7-849f-34d2682c0fad
logsource:
  category: process_creation
  product: windows
