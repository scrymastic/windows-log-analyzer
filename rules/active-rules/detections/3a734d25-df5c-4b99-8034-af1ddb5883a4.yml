detection:
- selection_eid:
  - and:
    - EventID|==: 4698
- selection_paths:
  - and:
    - or:
      - TaskContent|contains: \AppData\Local\Temp\
      - TaskContent|contains: \AppData\Roaming\
      - TaskContent|contains: \Users\Public\
      - TaskContent|contains: \WINDOWS\Temp\
      - TaskContent|contains: C:\Temp\
      - TaskContent|contains: \Desktop\
      - TaskContent|contains: \Downloads\
      - TaskContent|contains: \Temporary Internet
      - TaskContent|contains: C:\ProgramData\
      - TaskContent|contains: C:\Perflogs\
- selection_commands:
  - and:
    - or:
      - TaskContent|contains: regsvr32
      - TaskContent|contains: rundll32
      - TaskContent|contains: cmd.exe</Command>
      - TaskContent|contains: cmd</Command>
      - TaskContent|contains: '<Arguments>/c '
      - TaskContent|contains: '<Arguments>/k '
      - TaskContent|contains: '<Arguments>/r '
      - TaskContent|contains: powershell
      - TaskContent|contains: pwsh
      - TaskContent|contains: mshta
      - TaskContent|contains: wscript
      - TaskContent|contains: cscript
      - TaskContent|contains: certutil
      - TaskContent|contains: bitsadmin
      - TaskContent|contains: bash.exe
      - TaskContent|contains: 'bash '
      - TaskContent|contains: scrcons
      - TaskContent|contains: 'wmic '
      - TaskContent|contains: wmic.exe
      - TaskContent|contains: forfiles
      - TaskContent|contains: scriptrunner
      - TaskContent|contains: hh.exe
- condition: all of selection_*
id: 3a734d25-df5c-4b99-8034-af1ddb5883a4
logsource:
  definition: The Advanced Audit Policy setting Object Access > Audit Other Object
    Access Events has to be configured to allow this detection. We also recommend
    extracting the Command field from the embedded XML in the event data.
  product: windows
  service: security
