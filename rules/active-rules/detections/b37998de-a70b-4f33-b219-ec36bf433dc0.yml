detection:
- selection_parent_ext:
  - and:
    - or:
      - ParentCommandLine|contains: .bat
      - ParentCommandLine|contains: .chm
      - ParentCommandLine|contains: .cmd
      - ParentCommandLine|contains: .hta
      - ParentCommandLine|contains: .htm
      - ParentCommandLine|contains: .html
      - ParentCommandLine|contains: .js
      - ParentCommandLine|contains: .lnk
      - ParentCommandLine|contains: .ps1
      - ParentCommandLine|contains: .vbe
      - ParentCommandLine|contains: .vbs
      - ParentCommandLine|contains: .wsf
- selection_parent_path_1:
  - and:
    - or:
      - ParentCommandLine|contains: :\Perflogs\
      - ParentCommandLine|contains: :\Temp\
      - ParentCommandLine|contains: :\Users\Public\
      - ParentCommandLine|contains: :\Windows\Temp\
      - ParentCommandLine|contains: \AppData\Local\Temp
      - ParentCommandLine|contains: \AppData\Roaming\
      - ParentCommandLine|contains: \Temporary Internet
- selection_parent_path_2:
  - and:
    - or:
      - and:
        - ParentCommandLine|contains: :\Users\
        - ParentCommandLine|contains: \Favorites\
      - and:
        - ParentCommandLine|contains: :\Users\
        - ParentCommandLine|contains: \Favourites\
      - and:
        - ParentCommandLine|contains: :\Users\
        - ParentCommandLine|contains: \Contacts\
- selection_cli:
  - and:
    - or:
      - Image|endswith: \PingCastle.exe
      - OriginalFileName|==: PingCastle.exe
      - Product|==: Ping Castle
      - or:
        - CommandLine|contains: --scanner aclcheck
        - CommandLine|contains: --scanner antivirus
        - CommandLine|contains: --scanner computerversion
        - CommandLine|contains: --scanner foreignusers
        - CommandLine|contains: --scanner laps_bitlocker
        - CommandLine|contains: --scanner localadmin
        - CommandLine|contains: --scanner nullsession
        - CommandLine|contains: --scanner nullsession-trust
        - CommandLine|contains: --scanner oxidbindings
        - CommandLine|contains: --scanner remote
        - CommandLine|contains: --scanner share
        - CommandLine|contains: --scanner smb
        - CommandLine|contains: --scanner smb3querynetwork
        - CommandLine|contains: --scanner spooler
        - CommandLine|contains: --scanner startup
        - CommandLine|contains: --scanner zerologon
      - CommandLine|contains: --no-enum-limit
      - and:
        - CommandLine|contains: --healthcheck
        - CommandLine|contains: --level Full
      - and:
        - CommandLine|contains: --healthcheck
        - CommandLine|contains: '--server '
- condition: 1 of selection_parent_* and selection_parent_ext and selection_cli
id: b37998de-a70b-4f33-b219-ec36bf433dc0
logsource:
  category: process_creation
  product: windows
