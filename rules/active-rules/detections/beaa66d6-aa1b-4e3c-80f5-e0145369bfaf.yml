detection:
- selection_wmi:
  - and:
    - CommandLine|contains: Select
    - CommandLine|contains: Win32_NTLogEvent
- selection_wevtutil_img:
  - and:
    - or:
      - Image|endswith: \wevtutil.exe
      - OriginalFileName|==: wevtutil.exe
- selection_wevtutil_cli:
  - and:
    - or:
      - CommandLine|contains: ' qe '
      - CommandLine|contains: ' query-events '
- selection_wmic_img:
  - and:
    - or:
      - Image|endswith: \wmic.exe
      - OriginalFileName|==: wmic.exe
- selection_wmic_cli:
  - and:
    - CommandLine|contains: ' ntevent'
- selection_cmdlet:
  - and:
    - or:
      - CommandLine|contains: 'Get-WinEvent '
      - CommandLine|contains: 'get-eventlog '
- selection_logs_name:
  - and:
    - or:
      - CommandLine|contains: Microsoft-Windows-TerminalServices-LocalSessionManager/Operational
      - CommandLine|contains: Microsoft-Windows-Terminal-Services-RemoteConnectionManager/Operational
      - CommandLine|contains: Security
- selection_logs_eid:
  - and:
    - or:
      - CommandLine|contains: -InstanceId 4624
      - CommandLine|contains: System[EventID=4624]
      - CommandLine|contains: EventCode=?4624?
      - CommandLine|contains: EventIdentifier=?4624?
      - CommandLine|contains: -InstanceId 4778
      - CommandLine|contains: System[EventID=4778]
      - CommandLine|contains: EventCode=?4778?
      - CommandLine|contains: EventIdentifier=?4778?
      - CommandLine|contains: -InstanceId 25
      - CommandLine|contains: System[EventID=25]
      - CommandLine|contains: EventCode=?25?
      - CommandLine|contains: EventIdentifier=?25?
- condition: 1 of selection_logs_* and (selection_wmi or all of selection_wevtutil_*
    or all of selection_wmic_* or selection_cmdlet)
id: beaa66d6-aa1b-4e3c-80f5-e0145369bfaf
logsource:
  category: process_creation
  product: windows
