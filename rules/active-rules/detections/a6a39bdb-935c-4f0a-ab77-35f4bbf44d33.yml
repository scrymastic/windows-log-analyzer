detection:
- selection:
  - and:
    - or:
      - Image|endswith: \powershell.exe
      - Image|endswith: \pwsh.exe
      - Image|endswith: \mshta.exe
      - Image|endswith: \wscript.exe
      - Image|endswith: \cscript.exe
    - or:
      - CommandLine|contains: \Windows\Temp
      - CommandLine|contains: \Temporary Internet
      - CommandLine|contains: \AppData\Local\Temp
      - CommandLine|contains: \AppData\Roaming\Temp
      - CommandLine|contains: '%TEMP%'
      - CommandLine|contains: '%TMP%'
      - CommandLine|contains: '%LocalAppData%\Temp'
- filter:
  - and:
    - or:
      - CommandLine|contains: ' >'
      - CommandLine|contains: Out-File
      - CommandLine|contains: ConvertTo-Json
      - CommandLine|contains: -WindowStyle hidden -Verb runAs
      - CommandLine|contains: \Windows\system32\config\systemprofile\AppData\Local\Temp\Amazon\EC2-Windows\
- condition: selection and not filter
id: a6a39bdb-935c-4f0a-ab77-35f4bbf44d33
logsource:
  category: process_creation
  product: windows
