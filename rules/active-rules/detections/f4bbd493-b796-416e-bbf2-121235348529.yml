detection:
- selection:
  - and:
    - or:
      - or:
        - Image|endswith: \powershell.exe
        - Image|endswith: \pwsh.exe
      - or:
        - OriginalFileName|==: PowerShell.EXE
        - OriginalFileName|==: pwsh.dll
- filter_main_generic:
  - and:
    - or:
      - ParentImage|endswith: :\Windows\explorer.exe
      - ParentImage|endswith: :\Windows\System32\CompatTelRunner.exe
      - ParentImage|endswith: :\Windows\SysWOW64\explorer.exe
- filter_main_windows_update:
  - and:
    - ParentImage|==: :\$WINDOWS.~BT\Sources\SetupHost.exe
- filter_optional_vscode:
  - and:
    - ParentImage|endswith: \AppData\Local\Programs\Microsoft VS Code\Code.exe
    - ParentCommandLine|contains: ' --ms-enable-electron-run-as-node '
- filter_optional_terminal:
  - and:
    - ParentImage|contains: :\Program Files\WindowsApps\Microsoft.WindowsTerminal_
    - ParentImage|endswith: \WindowsTerminal.exe
- condition: selection and not 1 of filter_main_* and not 1 of filter_optional_*
id: f4bbd493-b796-416e-bbf2-121235348529
logsource:
  category: process_creation
  product: windows
