detection:
- selection:
  - and:
    - or:
      - ScriptBlockText|contains: Add-ConstrainedDelegationBackdoor
      - ScriptBlockText|contains: Copy-VSS
      - ScriptBlockText|contains: Create-MultipleSessions
      - ScriptBlockText|contains: DataToEncode
      - ScriptBlockText|contains: DNS_TXT_Pwnage
      - ScriptBlockText|contains: Do-Exfiltration-Dns
      - ScriptBlockText|contains: Download_Execute
      - ScriptBlockText|contains: Download-Execute-PS
      - ScriptBlockText|contains: DownloadAndExtractFromRemoteRegistry
      - ScriptBlockText|contains: DumpCerts
      - ScriptBlockText|contains: DumpCreds
      - ScriptBlockText|contains: DumpHashes
      - ScriptBlockText|contains: Enable-DuplicateToken
      - ScriptBlockText|contains: Enable-Duplication
      - ScriptBlockText|contains: Execute-Command-MSSQL
      - ScriptBlockText|contains: Execute-DNSTXT-Code
      - ScriptBlockText|contains: Execute-OnTime
      - ScriptBlockText|contains: ExetoText
      - ScriptBlockText|contains: exfill
      - ScriptBlockText|contains: ExfilOption
      - ScriptBlockText|contains: FakeDC
      - ScriptBlockText|contains: FireBuster
      - ScriptBlockText|contains: FireListener
      - ScriptBlockText|contains: 'Get-Information '
      - ScriptBlockText|contains: Get-PassHints
      - ScriptBlockText|contains: Get-Web-Credentials
      - ScriptBlockText|contains: Get-WebCredentials
      - ScriptBlockText|contains: Get-WLAN-Keys
      - ScriptBlockText|contains: HTTP-Backdoor
      - ScriptBlockText|contains: Invoke-AmsiBypass
      - ScriptBlockText|contains: Invoke-BruteForce
      - ScriptBlockText|contains: Invoke-CredentialsPhish
      - ScriptBlockText|contains: Invoke-Decode
      - ScriptBlockText|contains: Invoke-Encode
      - ScriptBlockText|contains: Invoke-Interceptor
      - ScriptBlockText|contains: Invoke-JSRatRegsvr
      - ScriptBlockText|contains: Invoke-JSRatRundll
      - ScriptBlockText|contains: Invoke-MimikatzWDigestDowngrade
      - ScriptBlockText|contains: Invoke-NetworkRelay
      - ScriptBlockText|contains: Invoke-PowerShellIcmp
      - ScriptBlockText|contains: Invoke-PowerShellUdp
      - ScriptBlockText|contains: Invoke-Prasadhak
      - ScriptBlockText|contains: Invoke-PSGcat
      - ScriptBlockText|contains: Invoke-PsGcatAgent
      - ScriptBlockText|contains: Invoke-SessionGopher
      - ScriptBlockText|contains: Invoke-SSIDExfil
      - ScriptBlockText|contains: LoggedKeys
      - ScriptBlockText|contains: Nishang
      - ScriptBlockText|contains: NotAllNameSpaces
      - ScriptBlockText|contains: Out-CHM
      - ScriptBlockText|contains: OUT-DNSTXT
      - ScriptBlockText|contains: Out-HTA
      - ScriptBlockText|contains: Out-RundllCommand
      - ScriptBlockText|contains: Out-SCF
      - ScriptBlockText|contains: Out-SCT
      - ScriptBlockText|contains: Out-Shortcut
      - ScriptBlockText|contains: Out-WebQuery
      - ScriptBlockText|contains: Out-Word
      - ScriptBlockText|contains: Parse_Keys
      - ScriptBlockText|contains: Password-List
      - ScriptBlockText|contains: Powerpreter
      - ScriptBlockText|contains: Remove-Persistence
      - ScriptBlockText|contains: Remove-PoshRat
      - ScriptBlockText|contains: Remove-Update
      - ScriptBlockText|contains: Run-EXEonRemote
      - ScriptBlockText|contains: Set-DCShadowPermissions
      - ScriptBlockText|contains: Set-RemotePSRemoting
      - ScriptBlockText|contains: Set-RemoteWMI
      - ScriptBlockText|contains: Shellcode32
      - ScriptBlockText|contains: Shellcode64
      - ScriptBlockText|contains: StringtoBase64
      - ScriptBlockText|contains: TexttoExe
- condition: selection
id: f772cee9-b7c2-4cb2-8f07-49870adc02e0
logsource:
  category: ps_script
  definition: 'Requirements: Script Block Logging must be enabled'
  product: windows
