detection:
- and:
  - or:
    - ParentImage|endswith: \WindowsTerminal.exe
    - ParentImage|endswith: \wt.exe
  - or:
    - or:
      - Image|endswith: \rundll32.exe
      - Image|endswith: \regsvr32.exe
      - Image|endswith: \certutil.exe
      - Image|endswith: \cscript.exe
      - Image|endswith: \wscript.exe
      - Image|endswith: \csc.exe
    - or:
      - Image|contains: C:\Users\Public\
      - Image|contains: \Downloads\
      - Image|contains: \Desktop\
      - Image|contains: \AppData\Local\Temp\
      - Image|contains: \Windows\TEMP\
    - or:
      - CommandLine|contains: ' iex '
      - CommandLine|contains: ' icm'
      - CommandLine|contains: Invoke-
      - CommandLine|contains: 'Import-Module '
      - CommandLine|contains: 'ipmo '
      - CommandLine|contains: DownloadString(
      - CommandLine|contains: ' /c '
      - CommandLine|contains: ' /k '
      - CommandLine|contains: ' /r '
  - or:
    - CommandLine|not contains: Import-Module
    - CommandLine|not contains: Microsoft.VisualStudio.DevShell.dll
    - CommandLine|not contains: Enter-VsDevShell
  - or:
    - CommandLine|not contains: \AppData\Local\Packages\Microsoft.WindowsTerminal_
    - CommandLine|not contains: \LocalState\settings.json
  - or:
    - CommandLine|not contains: C:\Program Files\Microsoft Visual Studio\
    - CommandLine|not contains: \Common7\Tools\VsDevCmd.bat
id: 8de89e52-f6e1-4b5b-afd1-41ecfa300d48
logsource:
  category: process_creation
  product: windows
