detection:
- selection_parent:
  - and:
    - or:
      - ParentImage|endswith: \WindowsTerminal.exe
      - ParentImage|endswith: \wt.exe
- selection_susp:
  - and:
    - or:
      - or:
        - Image|endswith: \rundll32.exe
        - Image|endswith: \regsvr32.exe
        - Image|endswith: \certutil.exe
        - Image|endswith: \cscript.exe
        - Image|endswith: \wscript.exe
        - Image|endswith: \csc.exe
      - or:
        - Image|contains: C:\Users\Public\
        - Image|contains: \Downloads\
        - Image|contains: \Desktop\
        - Image|contains: \AppData\Local\Temp\
        - Image|contains: \Windows\TEMP\
      - or:
        - CommandLine|contains: ' iex '
        - CommandLine|contains: ' icm'
        - CommandLine|contains: Invoke-
        - CommandLine|contains: 'Import-Module '
        - CommandLine|contains: 'ipmo '
        - CommandLine|contains: DownloadString(
        - CommandLine|contains: ' /c '
        - CommandLine|contains: ' /k '
        - CommandLine|contains: ' /r '
- filter_builtin_visual_studio_shell:
  - and:
    - CommandLine|contains: Import-Module
    - CommandLine|contains: Microsoft.VisualStudio.DevShell.dll
    - CommandLine|contains: Enter-VsDevShell
- filter_open_settings:
  - and:
    - CommandLine|contains: \AppData\Local\Packages\Microsoft.WindowsTerminal_
    - CommandLine|contains: \LocalState\settings.json
- filter_vsdevcmd:
  - and:
    - CommandLine|contains: C:\Program Files\Microsoft Visual Studio\
    - CommandLine|contains: \Common7\Tools\VsDevCmd.bat
- condition: all of selection_* and not 1 of filter_*
id: 8de89e52-f6e1-4b5b-afd1-41ecfa300d48
logsource:
  category: process_creation
  product: windows
