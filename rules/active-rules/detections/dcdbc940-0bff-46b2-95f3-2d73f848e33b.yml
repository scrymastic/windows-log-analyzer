detection:
- spoolsv:
  - and:
    - ParentImage|endswith: \spoolsv.exe
    - IntegrityLevel|==: System
- suspicious_unrestricted:
  - and:
    - or:
      - Image|endswith: \gpupdate.exe
      - Image|endswith: \whoami.exe
      - Image|endswith: \nltest.exe
      - Image|endswith: \taskkill.exe
      - Image|endswith: \wmic.exe
      - Image|endswith: \taskmgr.exe
      - Image|endswith: \sc.exe
      - Image|endswith: \findstr.exe
      - Image|endswith: \curl.exe
      - Image|endswith: \wget.exe
      - Image|endswith: \certutil.exe
      - Image|endswith: \bitsadmin.exe
      - Image|endswith: \accesschk.exe
      - Image|endswith: \wevtutil.exe
      - Image|endswith: \bcdedit.exe
      - Image|endswith: \fsutil.exe
      - Image|endswith: \cipher.exe
      - Image|endswith: \schtasks.exe
      - Image|endswith: \write.exe
      - Image|endswith: \wuauclt.exe
      - Image|endswith: \systeminfo.exe
      - Image|endswith: \reg.exe
      - Image|endswith: \query.exe
- suspicious_net:
  - and:
    - or:
      - Image|endswith: \net.exe
      - Image|endswith: \net1.exe
- suspicious_net_filter:
  - and:
    - CommandLine|contains: start
- suspicious_cmd:
  - and:
    - Image|endswith: \cmd.exe
- suspicious_cmd_filter:
  - and:
    - or:
      - CommandLine|contains: .spl
      - CommandLine|contains: route add
      - CommandLine|contains: program files
- suspicious_netsh:
  - and:
    - Image|endswith: \netsh.exe
- suspicious_netsh_filter:
  - and:
    - or:
      - CommandLine|contains: add portopening
      - CommandLine|contains: rule name
- suspicious_powershell:
  - and:
    - or:
      - Image|endswith: \powershell.exe
      - Image|endswith: \pwsh.exe
- suspicious_powershell_filter:
  - and:
    - CommandLine|contains: .spl
- suspicious_rundll32_img:
  - and:
    - or:
      - Image|endswith: \rundll32.exe
      - OriginalFileName|==: RUNDLL32.EXE
- suspicious_rundll32_cli:
  - and:
    - CommandLine|endswith: rundll32.exe
- condition: spoolsv and ( suspicious_unrestricted or (suspicious_net and not suspicious_net_filter)
    or (suspicious_cmd and not suspicious_cmd_filter) or (suspicious_netsh and not
    suspicious_netsh_filter) or (suspicious_powershell and not suspicious_powershell_filter)
    or all of suspicious_rundll32_* )
id: dcdbc940-0bff-46b2-95f3-2d73f848e33b
logsource:
  category: process_creation
  product: windows
