detection:
- selection_pwsh_binary:
  - and:
    - or:
      - or:
        - Image|endswith: \powershell.exe
        - Image|endswith: \pwsh.exe
      - or:
        - OriginalFileName|==: PowerShell.EXE
        - OriginalFileName|==: pwsh.dll
- selection_pwsh_cli:
  - and:
    - or:
      - CommandLine|contains: -DisableBehaviorMonitoring $true
      - CommandLine|contains: -DisableRuntimeMonitoring $true
- selection_sc_binary:
  - and:
    - or:
      - Image|endswith: \sc.exe
      - OriginalFileName|==: sc.exe
- selection_sc_tamper_cmd_stop:
  - and:
    - CommandLine|contains: stop
    - CommandLine|contains: WinDefend
- selection_sc_tamper_cmd_delete:
  - and:
    - CommandLine|contains: delete
    - CommandLine|contains: WinDefend
- selection_sc_tamper_cmd_disabled:
  - and:
    - CommandLine|contains: config
    - CommandLine|contains: WinDefend
    - CommandLine|contains: start=disabled
- condition: all of selection_pwsh_* or (selection_sc_binary and 1 of selection_sc_tamper_*)
id: a7ee1722-c3c5-aeff-3212-c777e4733217
logsource:
  category: process_creation
  product: windows
