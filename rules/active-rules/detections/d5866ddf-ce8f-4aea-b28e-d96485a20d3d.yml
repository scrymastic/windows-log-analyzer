detection:
- selection:
  - and:
    - or:
      - TargetFilename|endswith: \AtBroker.exe
      - TargetFilename|endswith: \audiodg.exe
      - TargetFilename|endswith: \backgroundTaskHost.exe
      - TargetFilename|endswith: \bcdedit.exe
      - TargetFilename|endswith: \bitsadmin.exe
      - TargetFilename|endswith: \cmdl32.exe
      - TargetFilename|endswith: \cmstp.exe
      - TargetFilename|endswith: \conhost.exe
      - TargetFilename|endswith: \csrss.exe
      - TargetFilename|endswith: \dasHost.exe
      - TargetFilename|endswith: \dfrgui.exe
      - TargetFilename|endswith: \dllhost.exe
      - TargetFilename|endswith: \dwm.exe
      - TargetFilename|endswith: \eventcreate.exe
      - TargetFilename|endswith: \eventvwr.exe
      - TargetFilename|endswith: \explorer.exe
      - TargetFilename|endswith: \extrac32.exe
      - TargetFilename|endswith: \fontdrvhost.exe
      - TargetFilename|endswith: \ipconfig.exe
      - TargetFilename|endswith: \iscsicli.exe
      - TargetFilename|endswith: \iscsicpl.exe
      - TargetFilename|endswith: \logman.exe
      - TargetFilename|endswith: \LogonUI.exe
      - TargetFilename|endswith: \LsaIso.exe
      - TargetFilename|endswith: \lsass.exe
      - TargetFilename|endswith: \lsm.exe
      - TargetFilename|endswith: \msiexec.exe
      - TargetFilename|endswith: \msinfo32.exe
      - TargetFilename|endswith: \mstsc.exe
      - TargetFilename|endswith: \nbtstat.exe
      - TargetFilename|endswith: \odbcconf.exe
      - TargetFilename|endswith: \powershell.exe
      - TargetFilename|endswith: \pwsh.exe
      - TargetFilename|endswith: \regini.exe
      - TargetFilename|endswith: \regsvr32.exe
      - TargetFilename|endswith: \rundll32.exe
      - TargetFilename|endswith: \RuntimeBroker.exe
      - TargetFilename|endswith: \schtasks.exe
      - TargetFilename|endswith: \SearchFilterHost.exe
      - TargetFilename|endswith: \SearchIndexer.exe
      - TargetFilename|endswith: \SearchProtocolHost.exe
      - TargetFilename|endswith: \SecurityHealthService.exe
      - TargetFilename|endswith: \SecurityHealthSystray.exe
      - TargetFilename|endswith: \services.exe
      - TargetFilename|endswith: \ShellAppRuntime.exe
      - TargetFilename|endswith: \sihost.exe
      - TargetFilename|endswith: \smartscreen.exe
      - TargetFilename|endswith: \smss.exe
      - TargetFilename|endswith: \spoolsv.exe
      - TargetFilename|endswith: \svchost.exe
      - TargetFilename|endswith: \SystemSettingsBroker.exe
      - TargetFilename|endswith: \taskhost.exe
      - TargetFilename|endswith: \taskhostw.exe
      - TargetFilename|endswith: \Taskmgr.exe
      - TargetFilename|endswith: \TiWorker.exe
      - TargetFilename|endswith: \vssadmin.exe
      - TargetFilename|endswith: \w32tm.exe
      - TargetFilename|endswith: \WerFault.exe
      - TargetFilename|endswith: \WerFaultSecure.exe
      - TargetFilename|endswith: \wermgr.exe
      - TargetFilename|endswith: \wevtutil.exe
      - TargetFilename|endswith: \wininit.exe
      - TargetFilename|endswith: \winlogon.exe
      - TargetFilename|endswith: \winrshost.exe
      - TargetFilename|endswith: \WinRTNetMUAHostServer.exe
      - TargetFilename|endswith: \wlanext.exe
      - TargetFilename|endswith: \wlrmdr.exe
      - TargetFilename|endswith: \WmiPrvSE.exe
      - TargetFilename|endswith: \wslhost.exe
      - TargetFilename|endswith: \WSReset.exe
      - TargetFilename|endswith: \WUDFHost.exe
      - TargetFilename|endswith: \WWAHost.exe
- filter_main_generic:
  - and:
    - or:
      - TargetFilename|contains: \SystemRoot\System32\
      - TargetFilename|contains: C:\$WINDOWS.~BT\
      - TargetFilename|contains: C:\$WinREAgent\
      - TargetFilename|contains: C:\Windows\SoftwareDistribution\
      - TargetFilename|contains: C:\Windows\System32\
      - TargetFilename|contains: C:\Windows\SysWOW64\
      - TargetFilename|contains: C:\Windows\WinSxS\
      - TargetFilename|contains: C:\Windows\uus\
- filter_main_svchost:
  - and:
    - Image|endswith: C:\Windows\system32\svchost.exe
    - TargetFilename|contains: C:\Program Files\WindowsApps\
- filter_main_wuauclt:
  - and:
    - Image|endswith: C:\Windows\System32\wuauclt.exe
- filter_main_explorer:
  - and:
    - TargetFilename|endswith: C:\Windows\explorer.exe
- filter_main_msiexec:
  - and:
    - Image|endswith: C:\WINDOWS\system32\msiexec.exe
    - or:
      - TargetFilename|endswith: C:\Program Files\PowerShell\7\pwsh.exe
      - TargetFilename|endswith: C:\Program Files\PowerShell\7-preview\pwsh.exe
- filter_main_healtray:
  - and:
    - TargetFilename|contains: C:\Windows\System32\SecurityHealth\
    - TargetFilename|endswith: \SecurityHealthSystray.exe
    - Image|endswith: \SecurityHealthSetup.exe
- condition: selection and not 1 of filter_main_*
id: d5866ddf-ce8f-4aea-b28e-d96485a20d3d
logsource:
  category: file_event
  product: windows
