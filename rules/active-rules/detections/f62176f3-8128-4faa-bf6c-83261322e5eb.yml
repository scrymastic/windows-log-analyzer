detection:
- and:
  - or:
    - ScriptBlockText|contains: AdjustTokenPrivileges
    - ScriptBlockText|contains: IMAGE_NT_OPTIONAL_HDR64_MAGIC
    - ScriptBlockText|contains: Metasploit
    - ScriptBlockText|contains: Microsoft.Win32.UnsafeNativeMethods
    - ScriptBlockText|contains: Mimikatz
    - ScriptBlockText|contains: MiniDumpWriteDump
    - ScriptBlockText|contains: PAGE_EXECUTE_READ
    - ScriptBlockText|contains: ReadProcessMemory.Invoke
    - ScriptBlockText|contains: SE_PRIVILEGE_ENABLED
    - ScriptBlockText|contains: SECURITY_DELEGATION
    - ScriptBlockText|contains: TOKEN_ADJUST_PRIVILEGES
    - ScriptBlockText|contains: TOKEN_ALL_ACCESS
    - ScriptBlockText|contains: TOKEN_ASSIGN_PRIMARY
    - ScriptBlockText|contains: TOKEN_DUPLICATE
    - ScriptBlockText|contains: TOKEN_ELEVATION
    - ScriptBlockText|contains: TOKEN_IMPERSONATE
    - ScriptBlockText|contains: TOKEN_INFORMATION_CLASS
    - ScriptBlockText|contains: TOKEN_PRIVILEGES
    - ScriptBlockText|contains: TOKEN_QUERY
id: f62176f3-8128-4faa-bf6c-83261322e5eb
logsource:
  category: ps_script
  definition: 'Requirements: Script Block Logging must be enabled'
  product: windows
