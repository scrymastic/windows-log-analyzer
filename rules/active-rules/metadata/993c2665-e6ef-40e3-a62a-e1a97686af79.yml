author: '@br4dy5'
date: 2023/10/09
description: 'Detects a user certificate that was valid but could not be mapped to
  a user in a strong way (such as via explicit mapping, key trust mapping, or a SID)

  This could be a sign of exploitation of the elevation of privilege vulnerabilities
  (CVE-2022-34691, CVE-2022-26931, CVE-2022-26923) that can occur when the KDC allows
  certificate spoofing by not requiring a strong mapping.

  Events where the AccountName and CN of the Subject do not match, or where the CN
  ends in a dollar sign indicating a machine, may indicate certificate spoofing.

  '
falsepositives:
- If prevalent in the environment, filter on events where the AccountName and CN of
  the Subject do not reference the same user
- If prevalent in the environment, filter on CNs that end in a dollar sign indicating
  it is a machine name
filename: win_system_kdcsvc_cert_use_no_strong_mapping.yml
level: medium
modified: ''
references:
- https://support.microsoft.com/en-us/topic/kb5014754-certificate-based-authentication-changes-on-windows-domain-controllers-ad2c23b0-15d8-4340-a468-4d4f3b188f16
related: []
status: experimental
tags:
- attack.privilege_escalation
