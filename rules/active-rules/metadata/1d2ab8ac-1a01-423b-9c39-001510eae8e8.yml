author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research), MSTIC
date: 2021/08/26
description: 'This detection uses Windows security events to detect suspicious access
  attempts to the registry key values and sub-keys of Azure AD Health service agents
  (e.g AD FS).

  Information from AD Health service agents can be used to potentially abuse some
  of the features provided by those services in the cloud (e.g. Federation).

  This detection requires an access control entry (ACE) on the system access control
  list (SACL) of the following securable object: HKLM:\SOFTWARE\Microsoft\ADHealthAgent.

  Make sure you set the SACL to propagate to its sub-keys.

  '
falsepositives:
- Unknown
level: medium
modified: 2022/10/09
references:
- https://o365blog.com/post/hybridhealthagent/
- https://github.com/OTRF/Set-AuditRule/blob/c3dec5443414231714d850565d364ca73475ade5/rules/registry/aad_connect_health_service_agent.yml
status: test
tags:
- attack.discovery
- attack.t1012
title: Azure AD Health Service Agents Registry Keys Access
