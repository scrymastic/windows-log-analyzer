title: NTDS.DIT Creation By Uncommon Parent Process
id: 4e7050dd-e548-483f-b7d6-527ab4fa784d
related:
- id: 11b1ed55-154d-4e82-8ad7-83739298f720
  type: similar
status: test
description: Detects creation of a file named "ntds.dit" (Active Directory Database)
  by an uncommon parent process or directory
references:
- https://www.ired.team/offensive-security/credential-access-and-credential-dumping/ntds.dit-enumeration
- https://www.n00py.io/2022/03/manipulating-user-passwords-without-mimikatz/
- https://pentestlab.blog/tag/ntds-dit/
- https://github.com/samratashok/nishang/blob/414ee1104526d7057f9adaeee196d91ae447283e/Gather/Copy-VSS.ps1
author: Florian Roth (Nextron Systems)
date: 2022/03/11
modified: 2023/01/05
tags:
- attack.credential_access
- attack.t1003.003
logsource:
  product: windows
  category: file_event
  definition: 'Requirements: The "ParentImage" field is not available by default on
    EID 11 of Sysmon logs. To be able to use this rule to the full extent you need
    to enrich the log with additional ParentImage data'
detection:
- and:
  - TargetFilename|endswith: \ntds.dit
  - or:
    - ParentImage|endswith: \cscript.exe
    - ParentImage|endswith: \httpd.exe
    - ParentImage|endswith: \nginx.exe
    - ParentImage|endswith: \php-cgi.exe
    - ParentImage|endswith: \powershell.exe
    - ParentImage|endswith: \pwsh.exe
    - ParentImage|endswith: \w3wp.exe
    - ParentImage|endswith: \wscript.exe
  - or:
    - ParentImage|contains: \apache
    - ParentImage|contains: \tomcat
    - ParentImage|contains: \AppData\
    - ParentImage|contains: \Temp\
    - ParentImage|contains: \Public\
    - ParentImage|contains: \PerfLogs\
falsepositives:
- Unknown
level: high
