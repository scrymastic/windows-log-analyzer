title: Suspicious Microsoft Office Child Process
id: 438025f9-5856-4663-83f7-52f878a70a50
related:
- id: c27515df-97a9-4162-8a60-dc0eeb51b775
  type: derived
- id: e1693bc8-7168-4eab-8718-cdcaa68a1738
  type: derived
- id: 23daeb52-e6eb-493c-8607-c4f0246cb7d8
  type: obsoletes
- id: 518643ba-7d9c-4fa5-9f37-baed36059f6a
  type: obsoletes
- id: 04f5363a-6bca-42ff-be70-0d28bf629ead
  type: obsoletes
status: test
description: Detects a suspicious process spawning from one of the Microsoft Office
  suite products (Word, Excel, PowerPoint, Publisher, Visio, etc.)
references:
- https://www.hybrid-analysis.com/sample/465aabe132ccb949e75b8ab9c5bda36d80cf2fd503d52b8bad54e295f28bbc21?environmentId=100
- https://mgreen27.github.io/posts/2018/04/02/DownloadCradle.html
- https://thedfirreport.com/2021/03/29/sodinokibi-aka-revil-ransomware/
- https://doublepulsar.com/follina-a-microsoft-office-code-execution-vulnerability-1a47fce5629e
- https://github.com/vadim-hunter/Detection-Ideas-Rules/blob/02bcbfc2bfb8b4da601bb30de0344ae453aa1afe/Threat%20Intelligence/The%20DFIR%20Report/20210329_Sodinokibi_(aka_REvil)_Ransomware.yaml
- https://github.com/splunk/security_content/blob/develop/detections/endpoint/office_spawning_control.yml
- https://twitter.com/andythevariable/status/1576953781581144064?s=20&t=QiJILvK4ZiBdR8RJe24u-A
- https://www.elastic.co/security-labs/exploring-the-ref2731-intrusion-set
- https://github.com/elastic/detection-rules/blob/c76a39796972ecde44cb1da6df47f1b6562c9770/rules/windows/defense_evasion_execution_msbuild_started_by_office_app.toml
- https://www.vmray.com/analyses/2d2fa29185ad/report/overview.html
- https://app.any.run/tasks/c903e9c8-0350-440c-8688-3881b556b8e0/
author: Florian Roth (Nextron Systems), Markus Neis, FPT.EagleEye Team, Vadim Khrykov,
  Cyb3rEng, Michael Haag, Christopher Peacock @securepeacock, @scythe_io
date: 2018/04/06
modified: 2023/04/24
tags:
- attack.defense_evasion
- attack.execution
- attack.t1047
- attack.t1204.002
- attack.t1218.010
logsource:
  category: process_creation
  product: windows
detection:
- selection_parent:
  - and:
    - or:
      - ParentImage|endswith: \EQNEDT32.EXE
      - ParentImage|endswith: \EXCEL.EXE
      - ParentImage|endswith: \MSACCESS.EXE
      - ParentImage|endswith: \MSPUB.exe
      - ParentImage|endswith: \ONENOTE.EXE
      - ParentImage|endswith: \POWERPNT.exe
      - ParentImage|endswith: \VISIO.exe
      - ParentImage|endswith: \WINWORD.EXE
      - ParentImage|endswith: \wordpad.exe
      - ParentImage|endswith: \wordview.exe
- selection_child_processes:
  - and:
    - or:
      - or:
        - OriginalFileName|==: bitsadmin.exe
        - OriginalFileName|==: CertOC.exe
        - OriginalFileName|==: CertUtil.exe
        - OriginalFileName|==: Cmd.Exe
        - OriginalFileName|==: CMSTP.EXE
        - OriginalFileName|==: cscript.exe
        - OriginalFileName|==: curl.exe
        - OriginalFileName|==: HH.exe
        - OriginalFileName|==: IEExec.exe
        - OriginalFileName|==: InstallUtil.exe
        - OriginalFileName|==: javaw.exe
        - OriginalFileName|==: Microsoft.Workflow.Compiler.exe
        - OriginalFileName|==: msdt.exe
        - OriginalFileName|==: MSHTA.EXE
        - OriginalFileName|==: msiexec.exe
        - OriginalFileName|==: Msxsl.exe
        - OriginalFileName|==: odbcconf.exe
        - OriginalFileName|==: pcalua.exe
        - OriginalFileName|==: PowerShell.EXE
        - OriginalFileName|==: RegAsm.exe
        - OriginalFileName|==: RegSvcs.exe
        - OriginalFileName|==: REGSVR32.exe
        - OriginalFileName|==: RUNDLL32.exe
        - OriginalFileName|==: schtasks.exe
        - OriginalFileName|==: ScriptRunner.exe
        - OriginalFileName|==: wmic.exe
        - OriginalFileName|==: WorkFolders.exe
        - OriginalFileName|==: wscript.exe
      - or:
        - Image|endswith: \AppVLP.exe
        - Image|endswith: \bash.exe
        - Image|endswith: \bitsadmin.exe
        - Image|endswith: \certoc.exe
        - Image|endswith: \certutil.exe
        - Image|endswith: \cmd.exe
        - Image|endswith: \cmstp.exe
        - Image|endswith: \control.exe
        - Image|endswith: \cscript.exe
        - Image|endswith: \curl.exe
        - Image|endswith: \forfiles.exe
        - Image|endswith: \hh.exe
        - Image|endswith: \ieexec.exe
        - Image|endswith: \installutil.exe
        - Image|endswith: \javaw.exe
        - Image|endswith: \mftrace.exe
        - Image|endswith: \Microsoft.Workflow.Compiler.exe
        - Image|endswith: \msbuild.exe
        - Image|endswith: \msdt.exe
        - Image|endswith: \mshta.exe
        - Image|endswith: \msidb.exe
        - Image|endswith: \msiexec.exe
        - Image|endswith: \msxsl.exe
        - Image|endswith: \odbcconf.exe
        - Image|endswith: \pcalua.exe
        - Image|endswith: \powershell.exe
        - Image|endswith: \pwsh.exe
        - Image|endswith: \regasm.exe
        - Image|endswith: \regsvcs.exe
        - Image|endswith: \regsvr32.exe
        - Image|endswith: \rundll32.exe
        - Image|endswith: \schtasks.exe
        - Image|endswith: \scrcons.exe
        - Image|endswith: \scriptrunner.exe
        - Image|endswith: \sh.exe
        - Image|endswith: \svchost.exe
        - Image|endswith: \verclsid.exe
        - Image|endswith: \wmic.exe
        - Image|endswith: \workfolders.exe
        - Image|endswith: \wscript.exe
- selection_child_susp_paths:
  - and:
    - or:
      - Image|contains: \AppData\
      - Image|contains: \Users\Public\
      - Image|contains: \ProgramData\
      - Image|contains: \Windows\Tasks\
      - Image|contains: \Windows\Temp\
      - Image|contains: \Windows\System32\Tasks\
- condition: selection_parent and 1 of selection_child_*
falsepositives:
- Unknown
level: high
