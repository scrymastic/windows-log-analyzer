title: Suspicious Scheduled Task Update
id: 614cf376-6651-47c4-9dcc-6b9527f749f4
related:
- id: 1c0e41cd-21bb-4433-9acc-4a2cd6367b9b
  type: similar
status: test
description: Detects update to a scheduled task event that contain suspicious keywords.
references:
- https://learn.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4698
author: Nasreddine Bencherchali (Nextron Systems)
date: 2022/12/05
tags:
- attack.execution
- attack.privilege_escalation
- attack.persistence
- attack.t1053.005
logsource:
  product: windows
  service: security
  definition: The Advanced Audit Policy setting Object Access > Audit Other Object
    Access Events has to be configured to allow this detection. We also recommend
    extracting the Command field from the embedded XML in the event data.
detection:
- selection_eid:
  - and:
    - EventID|==: 4702
- selection_paths:
  - and:
    - or:
      - TaskContentNew|contains: \AppData\Local\Temp\
      - TaskContentNew|contains: \AppData\Roaming\
      - TaskContentNew|contains: \Users\Public\
      - TaskContentNew|contains: \WINDOWS\Temp\
      - TaskContentNew|contains: C:\Temp\
      - TaskContentNew|contains: \Desktop\
      - TaskContentNew|contains: \Downloads\
      - TaskContentNew|contains: \Temporary Internet
      - TaskContentNew|contains: C:\ProgramData\
      - TaskContentNew|contains: C:\Perflogs\
- selection_commands:
  - and:
    - or:
      - TaskContentNew|contains: regsvr32
      - TaskContentNew|contains: rundll32
      - TaskContentNew|contains: cmd.exe</Command>
      - TaskContentNew|contains: cmd</Command>
      - TaskContentNew|contains: '<Arguments>/c '
      - TaskContentNew|contains: '<Arguments>/k '
      - TaskContentNew|contains: '<Arguments>/r '
      - TaskContentNew|contains: powershell
      - TaskContentNew|contains: pwsh
      - TaskContentNew|contains: mshta
      - TaskContentNew|contains: wscript
      - TaskContentNew|contains: cscript
      - TaskContentNew|contains: certutil
      - TaskContentNew|contains: bitsadmin
      - TaskContentNew|contains: bash.exe
      - TaskContentNew|contains: 'bash '
      - TaskContentNew|contains: scrcons
      - TaskContentNew|contains: 'wmic '
      - TaskContentNew|contains: wmic.exe
      - TaskContentNew|contains: forfiles
      - TaskContentNew|contains: scriptrunner
      - TaskContentNew|contains: hh.exe
- condition: all of selection_*
falsepositives:
- Unknown
level: high
