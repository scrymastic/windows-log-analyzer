title: Suspicious Process Patterns NTDS.DIT Exfil
id: 8bc64091-6875-4881-aaf9-7bd25b5dda08
status: test
description: Detects suspicious process patterns used in NTDS.DIT exfiltration
references:
- https://www.ired.team/offensive-security/credential-access-and-credential-dumping/ntds.dit-enumeration
- https://www.n00py.io/2022/03/manipulating-user-passwords-without-mimikatz/
- https://pentestlab.blog/tag/ntds-dit/
- https://github.com/samratashok/nishang/blob/414ee1104526d7057f9adaeee196d91ae447283e/Gather/Copy-VSS.ps1
- https://github.com/zcgonvh/NTDSDumpEx
- https://github.com/rapid7/metasploit-framework/blob/d297adcebb5c1df6fe30b12ca79b161deb71571c/data/post/powershell/NTDSgrab.ps1
- https://blog.talosintelligence.com/2022/08/recent-cyber-attack.html?m=1
author: Florian Roth (Nextron Systems)
date: 2022/03/11
modified: 2022/11/10
tags:
- attack.credential_access
- attack.t1003.003
logsource:
  product: windows
  category: process_creation
detection:
- and:
  - or:
    - or:
      - or:
        - Image|endswith: \NTDSDump.exe
        - Image|endswith: \NTDSDumpEx.exe
      - CommandLine|contains: ntds.dit
      - CommandLine|contains: system.hiv
      - CommandLine|contains: NTDSgrab.ps1
  - or:
    - CommandLine|contains: ac i ntds
    - CommandLine|contains: create full
  - or:
    - CommandLine|contains: '/c copy '
    - CommandLine|contains: \windows\ntds\ntds.dit
  - or:
    - CommandLine|contains: activate instance ntds
    - CommandLine|contains: create full
  - or:
    - CommandLine|contains: powershell
    - CommandLine|contains: ntds.dit
  - or:
    - CommandLine|contains: ntds.dit
  - or:
    - or:
      - or:
        - ParentImage|contains: \apache
        - ParentImage|contains: \tomcat
        - ParentImage|contains: \AppData\
        - ParentImage|contains: \Temp\
        - ParentImage|contains: \Public\
        - ParentImage|contains: \PerfLogs\
      - or:
        - Image|contains: \apache
        - Image|contains: \tomcat
        - Image|contains: \AppData\
        - Image|contains: \Temp\
        - Image|contains: \Public\
        - Image|contains: \PerfLogs\
falsepositives:
- Unknown
level: high
