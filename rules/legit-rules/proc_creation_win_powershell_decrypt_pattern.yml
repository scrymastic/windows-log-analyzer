title: PowerShell Execution With Potential Decryption Capabilities
id: 434c08ba-8406-4d15-8b24-782cb071a691
status: experimental
description: Detects PowerShell commands that decrypt an ".LNK" "file to drop the
  next stage of the malware.
references:
- https://research.checkpoint.com/2023/chinese-threat-actors-targeting-europe-in-smugx-campaign/
author: X__Junior (Nextron Systems), Nasreddine Bencherchali (Nextron Systems)
date: 2023/06/30
modified: 2023/12/05
tags:
- attack.execution
logsource:
  product: windows
  category: process_creation
detection:
- and:
  - or:
    - Image|endswith: \powershell.exe
    - Image|endswith: \pwsh.exe
  - or:
    - OriginalFileName|==: PowerShell.EXE
    - OriginalFileName|==: pwsh.dll
  - or:
    - CommandLine|contains: 'Get-ChildItem '
    - CommandLine|contains: 'dir '
    - CommandLine|contains: 'gci '
    - CommandLine|contains: 'ls '
  - or:
    - CommandLine|contains: 'Get-Content '
    - CommandLine|contains: 'gc '
    - CommandLine|contains: 'cat '
    - CommandLine|contains: 'type '
    - CommandLine|contains: ReadAllBytes
  - or:
    - CommandLine|contains: ' ^| '
    - CommandLine|contains: \*.lnk
    - CommandLine|contains: -Recurse
    - CommandLine|contains: '-Skip '
    - CommandLine|contains: ' -ExpandProperty '
    - CommandLine|contains: \*.lnk
    - CommandLine|contains: WriteAllBytes
    - CommandLine|contains: ' .length '
falsepositives:
- Unlikely
level: high
