title: File With Uncommon Extension Created By An Office Application
id: c7a74c80-ba5a-486e-9974-ab9e682bc5e4
status: experimental
description: Detects the creation of files with an executable or script extension
  by an Office application.
references:
- https://thedfirreport.com/2021/03/29/sodinokibi-aka-revil-ransomware/
- https://github.com/vadim-hunter/Detection-Ideas-Rules/blob/02bcbfc2bfb8b4da601bb30de0344ae453aa1afe/Threat%20Intelligence/The%20DFIR%20Report/20210329_Sodinokibi_(aka_REvil)_Ransomware.yaml
author: Vadim Khrykov (ThreatIntel), Cyb3rEng (Rule), Nasreddine Bencherchali (Nextron
  Systems)
date: 2021/08/23
modified: 2023/06/22
tags:
- attack.t1204.002
- attack.execution
logsource:
  product: windows
  category: file_event
detection:
- selection1:
  - and:
    - or:
      - Image|endswith: \excel.exe
      - Image|endswith: \msaccess.exe
      - Image|endswith: \mspub.exe
      - Image|endswith: \powerpnt.exe
      - Image|endswith: \visio.exe
      - Image|endswith: \winword.exe
- selection2:
  - and:
    - or:
      - TargetFilename|endswith: .bat
      - TargetFilename|endswith: .cmd
      - TargetFilename|endswith: .com
      - TargetFilename|endswith: .dll
      - TargetFilename|endswith: .exe
      - TargetFilename|endswith: .hta
      - TargetFilename|endswith: .ocx
      - TargetFilename|endswith: .proj
      - TargetFilename|endswith: .ps1
      - TargetFilename|endswith: .scf
      - TargetFilename|endswith: .scr
      - TargetFilename|endswith: .sys
      - TargetFilename|endswith: .vbe
      - TargetFilename|endswith: .vbs
      - TargetFilename|endswith: .wsf
      - TargetFilename|endswith: .wsh
- filter_optional_webservicecache:
  - and:
    - TargetFilename|contains: C:\Users\
    - TargetFilename|contains: \AppData\Local\Microsoft\Office\
    - TargetFilename|contains: \WebServiceCache\AllUsers
    - TargetFilename|endswith: .com
- filter_optional_webex:
  - and:
    - Image|endswith: \winword.exe
    - TargetFilename|contains: \AppData\Local\Temp\webexdelta\
    - or:
      - TargetFilename|endswith: .dll
      - TargetFilename|endswith: .exe
- filter_main_localassembly:
  - and:
    - TargetFilename|contains: \AppData\Local\assembly\tmp\
    - TargetFilename|endswith: .dll
- condition: all of selection* and not 1 of filter_main_* and not 1 of filter_optional_*
falsepositives:
- Unknown
level: high
