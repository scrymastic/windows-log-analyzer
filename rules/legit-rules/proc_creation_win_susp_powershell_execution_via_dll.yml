title: Potential PowerShell Execution Via DLL
id: 6812a10b-60ea-420c-832f-dfcc33b646ba
status: test
description: 'Detects potential PowerShell execution from a DLL instead of the usual
  PowerShell process as seen used in PowerShdll.

  This detection assumes that PowerShell commands are passed via the CommandLine.

  '
references:
- https://github.com/p3nt4/PowerShdll/blob/62cfa172fb4e1f7f4ac00ca942685baeb88ff356/README.md
author: Markus Neis, Nasreddine Bencherchali (Nextron Systems)
date: 2018/08/25
modified: 2024/03/07
tags:
- attack.defense_evasion
- attack.t1218.011
logsource:
  category: process_creation
  product: windows
detection:
- selection_img:
  - and:
    - or:
      - or:
        - Image|endswith: \InstallUtil.exe
        - Image|endswith: \RegAsm.exe
        - Image|endswith: \RegSvcs.exe
        - Image|endswith: \regsvr32.exe
        - Image|endswith: \rundll32.exe
      - or:
        - OriginalFileName|==: InstallUtil.exe
        - OriginalFileName|==: RegAsm.exe
        - OriginalFileName|==: RegSvcs.exe
        - OriginalFileName|==: REGSVR32.EXE
        - OriginalFileName|==: RUNDLL32.EXE
- selection_cli:
  - and:
    - or:
      - CommandLine|contains: Default.GetString
      - CommandLine|contains: DownloadString
      - CommandLine|contains: FromBase64String
      - CommandLine|contains: 'ICM '
      - CommandLine|contains: 'IEX '
      - CommandLine|contains: Invoke-Command
      - CommandLine|contains: Invoke-Expression
- condition: all of selection_*
falsepositives:
- Unknown
level: high
