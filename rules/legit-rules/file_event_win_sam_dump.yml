title: Potential SAM Database Dump
id: 4e87b8e2-2ee9-4b2a-a715-4727d297ece0
status: test
description: Detects the creation of files that look like exports of the local SAM
  (Security Account Manager)
references:
- https://github.com/search?q=CVE-2021-36934
- https://github.com/cube0x0/CVE-2021-36934
- https://www.google.com/search?q=%22reg.exe+save%22+sam
- https://github.com/HuskyHacks/ShadowSteal
- https://github.com/FireFart/hivenightmare
author: Florian Roth (Nextron Systems)
date: 2022/02/11
modified: 2023/01/05
tags:
- attack.credential_access
- attack.t1003.002
logsource:
  product: windows
  category: file_event
detection:
- selection:
  - and:
    - or:
      - or:
        - TargetFilename|endswith: \Temp\sam
        - TargetFilename|endswith: \sam.sav
        - TargetFilename|endswith: \Intel\sam
        - TargetFilename|endswith: \sam.hive
        - TargetFilename|endswith: \Perflogs\sam
        - TargetFilename|endswith: \ProgramData\sam
        - TargetFilename|endswith: \Users\Public\sam
        - TargetFilename|endswith: \AppData\Local\sam
        - TargetFilename|endswith: \AppData\Roaming\sam
        - TargetFilename|endswith: _ShadowSteal.zip
        - TargetFilename|endswith: \Documents\SAM.export
        - TargetFilename|endswith: :\sam
      - or:
        - TargetFilename|contains: \hive_sam_
        - TargetFilename|contains: \sam.save
        - TargetFilename|contains: \sam.export
        - TargetFilename|contains: \~reg_sam.save
        - TargetFilename|contains: \sam_backup
        - TargetFilename|contains: \sam.bck
        - TargetFilename|contains: \sam.backup
- condition: selection
falsepositives:
- Rare cases of administrative activity
level: high
