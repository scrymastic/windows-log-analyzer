title: Potential Persistence Attempt Via Existing Service Tampering
id: 38879043-7e1e-47a9-8d46-6bec88e201df
status: test
description: Detects the modification of an existing service in order to execute an
  arbitrary payload when the service is started or killed as a potential method for
  persistence.
references:
- https://pentestlab.blog/2020/01/22/persistence-modify-existing-service/
author: Sreeman
date: 2020/09/29
modified: 2023/02/04
tags:
- attack.persistence
- attack.t1543.003
- attack.t1574.011
logsource:
  category: process_creation
  product: windows
detection:
- and:
  - or:
    - CommandLine|contains: 'sc '
    - CommandLine|contains: 'config '
    - CommandLine|contains: binpath=
    - CommandLine|contains: 'sc '
    - CommandLine|contains: failure
    - CommandLine|contains: command=
  - or:
    - CommandLine|contains: 'reg '
    - CommandLine|contains: 'add '
    - CommandLine|contains: FailureCommand
    - CommandLine|contains: 'reg '
    - CommandLine|contains: 'add '
    - CommandLine|contains: ImagePath
  - or:
    - CommandLine|contains: .sh
    - CommandLine|contains: .exe
    - CommandLine|contains: .dll
    - CommandLine|contains: .bin$
    - CommandLine|contains: .bat
    - CommandLine|contains: .cmd
    - CommandLine|contains: .js
    - CommandLine|contains: .msh$
    - CommandLine|contains: .reg$
    - CommandLine|contains: .scr
    - CommandLine|contains: .ps
    - CommandLine|contains: .vb
    - CommandLine|contains: .jar
    - CommandLine|contains: .pl
falsepositives:
- Unknown
level: medium
