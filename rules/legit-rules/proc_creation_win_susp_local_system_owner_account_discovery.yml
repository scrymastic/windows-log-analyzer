title: Local Accounts Discovery
id: 502b42de-4306-40b4-9596-6f590c81f073
status: test
description: Local accounts, System Owner/User discovery using operating systems utilities
references:
- https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1033/T1033.md
author: Timur Zinniatullin, Daniil Yugoslavskiy, oscd.community
date: 2019/10/21
modified: 2023/01/03
tags:
- attack.discovery
- attack.t1033
- attack.t1087.001
logsource:
  category: process_creation
  product: windows
detection:
- selection_other_img:
  - and:
    - or:
      - Image|endswith: \whoami.exe
      - Image|endswith: \quser.exe
      - Image|endswith: \qwinsta.exe
- selection_other_wmi:
  - and:
    - Image|endswith: \wmic.exe
    - CommandLine|contains: useraccount
    - CommandLine|contains: get
- selection_other_cmdkey:
  - and:
    - Image|endswith: \cmdkey.exe
    - CommandLine|contains: ' /l'
- selection_cmd:
  - and:
    - Image|endswith: \cmd.exe
    - CommandLine|contains: ' /c'
    - CommandLine|contains: 'dir '
    - CommandLine|contains: \Users\
- filter_cmd:
  - and:
    - CommandLine|contains: ' rmdir '
- selection_net:
  - and:
    - or:
      - Image|endswith: \net.exe
      - Image|endswith: \net1.exe
    - CommandLine|contains: user
- filter_net:
  - and:
    - or:
      - CommandLine|contains: /domain
      - CommandLine|contains: /add
      - CommandLine|contains: /delete
      - CommandLine|contains: /active
      - CommandLine|contains: /expires
      - CommandLine|contains: /passwordreq
      - CommandLine|contains: /scriptpath
      - CommandLine|contains: /times
      - CommandLine|contains: /workstations
- condition: (selection_cmd and not filter_cmd) or (selection_net and not filter_net)
    or 1 of selection_other_*
falsepositives:
- Legitimate administrator or user enumerates local users for legitimate reason
level: low
