title: Suspicious MSHTA Child Process
id: 03cc0c25-389f-4bf8-b48d-11878079f1ca
status: test
description: Detects a suspicious process spawning from an "mshta.exe" process, which
  could be indicative of a malicious HTA script execution
references:
- https://www.trustedsec.com/july-2015/malicious-htas/
author: Michael Haag
date: 2019/01/16
modified: 2023/02/06
tags:
- attack.defense_evasion
- attack.t1218.005
- car.2013-02-003
- car.2013-03-001
- car.2014-04-003
logsource:
  category: process_creation
  product: windows
detection:
- selection_parent:
  - and:
    - ParentImage|endswith: \mshta.exe
- selection_child:
  - and:
    - or:
      - or:
        - Image|endswith: \cmd.exe
        - Image|endswith: \powershell.exe
        - Image|endswith: \pwsh.exe
        - Image|endswith: \wscript.exe
        - Image|endswith: \cscript.exe
        - Image|endswith: \sh.exe
        - Image|endswith: \bash.exe
        - Image|endswith: \reg.exe
        - Image|endswith: \regsvr32.exe
        - Image|endswith: \bitsadmin.exe
      - or:
        - OriginalFileName|==: Cmd.Exe
        - OriginalFileName|==: PowerShell.EXE
        - OriginalFileName|==: pwsh.dll
        - OriginalFileName|==: wscript.exe
        - OriginalFileName|==: cscript.exe
        - OriginalFileName|==: Bash.exe
        - OriginalFileName|==: reg.exe
        - OriginalFileName|==: REGSVR32.EXE
        - OriginalFileName|==: bitsadmin.exe
- condition: all of selection*
falsepositives:
- Printer software / driver installations
- HP software
level: high
