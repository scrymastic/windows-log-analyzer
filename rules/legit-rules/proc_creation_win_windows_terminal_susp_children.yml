title: Suspicious WindowsTerminal Child Processes
id: 8de89e52-f6e1-4b5b-afd1-41ecfa300d48
status: test
description: Detects suspicious children spawned via the Windows Terminal application
  which could be a sign of persistence via WindowsTerminal (see references section)
references:
- https://persistence-info.github.io/Data/windowsterminalprofile.html
- https://twitter.com/nas_bench/status/1550836225652686848
author: Nasreddine Bencherchali (Nextron Systems)
date: 2022/07/25
modified: 2023/02/14
tags:
- attack.execution
- attack.persistence
logsource:
  category: process_creation
  product: windows
detection:
- and:
  - or:
    - ParentImage|endswith: \WindowsTerminal.exe
    - ParentImage|endswith: \wt.exe
  - or:
    - or:
      - Image|endswith: \rundll32.exe
      - Image|endswith: \regsvr32.exe
      - Image|endswith: \certutil.exe
      - Image|endswith: \cscript.exe
      - Image|endswith: \wscript.exe
      - Image|endswith: \csc.exe
    - or:
      - Image|contains: C:\Users\Public\
      - Image|contains: \Downloads\
      - Image|contains: \Desktop\
      - Image|contains: \AppData\Local\Temp\
      - Image|contains: \Windows\TEMP\
    - or:
      - CommandLine|contains: ' iex '
      - CommandLine|contains: ' icm'
      - CommandLine|contains: Invoke-
      - CommandLine|contains: 'Import-Module '
      - CommandLine|contains: 'ipmo '
      - CommandLine|contains: DownloadString(
      - CommandLine|contains: ' /c '
      - CommandLine|contains: ' /k '
      - CommandLine|contains: ' /r '
falsepositives:
- Other legitimate "Windows Terminal" profiles
level: medium
