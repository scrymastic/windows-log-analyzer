title: File Download From IP URL Via Curl.EXE
id: 9cc85849-3b02-4cb5-b371-3a1ff54f2218
related:
- id: 5cb299fc-5fb1-4d07-b989-0644c68b6043
  type: similar
status: experimental
description: Detects file downloads directly from IP address URL using curl.exe
references:
- https://labs.withsecure.com/publications/fin7-target-veeam-servers
- https://github.com/WithSecureLabs/iocs/blob/344203de742bb7e68bd56618f66d34be95a9f9fc/FIN7VEEAM/iocs.csv
- https://github.com/pr0xylife/IcedID/blob/8dd1e218460db4f750d955b4c65b2f918a1db906/icedID_09.28.2023.txt
author: Nasreddine Bencherchali (Nextron Systems)
date: 2023/10/18
tags:
- attack.execution
logsource:
  category: process_creation
  product: windows
detection:
- selection_img:
  - and:
    - or:
      - Image|endswith: \curl.exe
      - OriginalFileName|==: curl.exe
- selection_ip:
  - and:
    - CommandLine|matches: ://[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}
- selection_http:
  - and:
    - CommandLine|contains: http
- selection_flag:
  - and:
    - or:
      - CommandLine|contains: ' -O'
      - CommandLine|contains: --remote-name
      - CommandLine|contains: --output
- filter_main_ext:
  - and:
    - or:
      - CommandLine|endswith: .bat
      - CommandLine|endswith: .bat"
      - CommandLine|endswith: .dat
      - CommandLine|endswith: .dat"
      - CommandLine|endswith: .dll
      - CommandLine|endswith: .dll"
      - CommandLine|endswith: .exe
      - CommandLine|endswith: .exe"
      - CommandLine|endswith: .gif
      - CommandLine|endswith: .gif"
      - CommandLine|endswith: .hta
      - CommandLine|endswith: .hta"
      - CommandLine|endswith: .jpeg
      - CommandLine|endswith: .jpeg"
      - CommandLine|endswith: .log
      - CommandLine|endswith: .log"
      - CommandLine|endswith: .msi
      - CommandLine|endswith: .msi"
      - CommandLine|endswith: .png
      - CommandLine|endswith: .png"
      - CommandLine|endswith: .ps1
      - CommandLine|endswith: .ps1"
      - CommandLine|endswith: .psm1
      - CommandLine|endswith: .psm1"
      - CommandLine|endswith: .vbe
      - CommandLine|endswith: .vbe"
      - CommandLine|endswith: .vbs
      - CommandLine|endswith: .vbs"
      - CommandLine|endswith: .bat'
      - CommandLine|endswith: .dat'
      - CommandLine|endswith: .dll'
      - CommandLine|endswith: .exe'
      - CommandLine|endswith: .gif'
      - CommandLine|endswith: .hta'
      - CommandLine|endswith: .jpeg'
      - CommandLine|endswith: .log'
      - CommandLine|endswith: .msi'
      - CommandLine|endswith: .png'
      - CommandLine|endswith: .ps1'
      - CommandLine|endswith: .psm1'
      - CommandLine|endswith: .vbe'
      - CommandLine|endswith: .vbs'
- condition: all of selection_* and not 1 of filter_main_*
falsepositives:
- Unknown
level: medium
