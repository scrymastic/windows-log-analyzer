title: HackTool - Certipy Execution
id: 6938366d-8954-4ddc-baff-c830b3ba8fcd
status: test
description: Detects Certipy a tool for Active Directory Certificate Services enumeration
  and abuse based on PE metadata characteristics and common command line arguments.
references:
- https://github.com/ly4k/Certipy
author: pH-T (Nextron Systems)
date: 2023/04/17
tags:
- attack.discovery
- attack.credential_access
- attack.t1649
logsource:
  category: process_creation
  product: windows
detection:
- selection_img:
  - and:
    - or:
      - Image|endswith: \Certipy.exe
      - OriginalFileName|==: Certipy.exe
      - Description|contains: Certipy
- selection_cli_commands:
  - and:
    - or:
      - CommandLine|contains: ' auth '
      - CommandLine|contains: ' find '
      - CommandLine|contains: ' forge '
      - CommandLine|contains: ' relay '
      - CommandLine|contains: ' req '
      - CommandLine|contains: ' shadow '
- selection_cli_flags:
  - and:
    - or:
      - CommandLine|contains: ' -bloodhound'
      - CommandLine|contains: ' -ca-pfx '
      - CommandLine|contains: ' -dc-ip '
      - CommandLine|contains: ' -kirbi'
      - CommandLine|contains: ' -old-bloodhound'
      - CommandLine|contains: ' -pfx '
      - CommandLine|contains: ' -target'
      - CommandLine|contains: ' -username '
      - CommandLine|contains: ' -vulnerable'
      - CommandLine|contains: auth -pfx
      - CommandLine|contains: shadow auto
      - CommandLine|contains: shadow list
- condition: selection_img or all of selection_cli_*
falsepositives:
- Unlikely
level: high
