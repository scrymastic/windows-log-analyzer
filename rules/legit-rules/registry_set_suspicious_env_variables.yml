title: Suspicious Environment Variable Has Been Registered
id: 966315ef-c5e1-4767-ba25-fce9c8de3660
status: test
description: Detects the creation of user-specific or system-wide environment variables
  via the registry. Which contains suspicious commands and strings
references:
- https://infosec.exchange/@sbousseaden/109542254124022664
author: Nasreddine Bencherchali (Nextron Systems)
date: 2022/12/20
modified: 2023/08/17
tags:
- attack.defense_evasion
- attack.persistence
logsource:
  product: windows
  category: registry_set
detection:
- selection_main:
  - and:
    - TargetObject|contains: \Environment\
- selection_details:
  - and:
    - or:
      - or:
        - Details|==: powershell
        - Details|==: pwsh
      - or:
        - Details|contains: \AppData\Local\Temp\
        - Details|contains: C:\Users\Public\
        - Details|contains: TVqQAAMAAAAEAAAA
        - Details|contains: TVpQAAIAAAAEAA8A
        - Details|contains: TVqAAAEAAAAEABAA
        - Details|contains: TVoAAAAAAAAAAAAA
        - Details|contains: TVpTAQEAAAAEAAAA
        - Details|contains: SW52b2tlL
        - Details|contains: ludm9rZS
        - Details|contains: JbnZva2Ut
        - Details|contains: SQBuAHYAbwBrAGUALQ
        - Details|contains: kAbgB2AG8AawBlAC0A
        - Details|contains: JAG4AdgBvAGsAZQAtA
      - or:
        - Details|startswith: SUVY
        - Details|startswith: SQBFAF
        - Details|startswith: SQBuAH
        - Details|startswith: cwBhA
        - Details|startswith: aWV4
        - Details|startswith: aQBlA
        - Details|startswith: R2V0
        - Details|startswith: dmFy
        - Details|startswith: dgBhA
        - Details|startswith: dXNpbm
        - Details|startswith: H4sIA
        - Details|startswith: Y21k
        - Details|startswith: cABhAH
        - Details|startswith: Qzpc
        - Details|startswith: Yzpc
- condition: all of selection_*
falsepositives:
- Unknown
level: high
