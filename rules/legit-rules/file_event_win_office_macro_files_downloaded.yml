title: Office Macro File Download
id: 0e29e3a7-1ad8-40aa-b691-9f82ecd33d66
related:
- id: 91174a41-dc8f-401b-be89-7bfc140612a0
  type: similar
status: test
description: Detects the creation of a new office macro files on the systems via an
  application (browser, mail client).
references:
- https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1566.001/T1566.001.md
- https://docs.microsoft.com/en-us/deployoffice/compat/office-file-format-reference
author: Nasreddine Bencherchali (Nextron Systems)
date: 2022/01/23
modified: 2023/04/18
tags:
- attack.initial_access
- attack.t1566.001
logsource:
  category: file_event
  product: windows
detection:
- selection_processes:
  - and:
    - or:
      - Image|endswith: \RuntimeBroker.exe
      - Image|endswith: \outlook.exe
      - Image|endswith: \thunderbird.exe
      - Image|endswith: \brave.exe
      - Image|endswith: \chrome.exe
      - Image|endswith: \firefox.exe
      - Image|endswith: \iexplore.exe
      - Image|endswith: \maxthon.exe
      - Image|endswith: \MicrosoftEdge.exe
      - Image|endswith: \msedge.exe
      - Image|endswith: \msedgewebview2.exe
      - Image|endswith: \opera.exe
      - Image|endswith: \safari.exe
      - Image|endswith: \seamonkey.exe
      - Image|endswith: \vivaldi.exe
      - Image|endswith: \whale.exe
- selection_ext:
  - and:
    - or:
      - or:
        - TargetFilename|endswith: .docm
        - TargetFilename|endswith: .dotm
        - TargetFilename|endswith: .xlsm
        - TargetFilename|endswith: .xltm
        - TargetFilename|endswith: .potm
        - TargetFilename|endswith: .pptm
      - or:
        - TargetFilename|contains: .docm:Zone
        - TargetFilename|contains: .dotm:Zone
        - TargetFilename|contains: .xlsm:Zone
        - TargetFilename|contains: .xltm:Zone
        - TargetFilename|contains: .potm:Zone
        - TargetFilename|contains: .pptm:Zone
- condition: all of selection_*
falsepositives:
- Legitimate macro files downloaded from the internet
- Legitimate macro files sent as attachments via emails
level: medium
