title: Suspicious Scheduled Task Creation
id: 3a734d25-df5c-4b99-8034-af1ddb5883a4
status: test
description: Detects suspicious scheduled task creation events. Based on attributes
  such as paths, commands line flags, etc.
references:
- https://learn.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4698
author: Nasreddine Bencherchali (Nextron Systems)
date: 2022/12/05
modified: 2022/12/07
tags:
- attack.execution
- attack.privilege_escalation
- attack.persistence
- attack.t1053.005
logsource:
  product: windows
  service: security
  definition: The Advanced Audit Policy setting Object Access > Audit Other Object
    Access Events has to be configured to allow this detection. We also recommend
    extracting the Command field from the embedded XML in the event data.
detection:
- and:
  - EventID|==: 4698
  - or:
    - TaskContent|contains: \AppData\Local\Temp\
    - TaskContent|contains: \AppData\Roaming\
    - TaskContent|contains: \Users\Public\
    - TaskContent|contains: \WINDOWS\Temp\
    - TaskContent|contains: C:\Temp\
    - TaskContent|contains: \Desktop\
    - TaskContent|contains: \Downloads\
    - TaskContent|contains: \Temporary Internet
    - TaskContent|contains: C:\ProgramData\
    - TaskContent|contains: C:\Perflogs\
  - or:
    - TaskContent|contains: regsvr32
    - TaskContent|contains: rundll32
    - TaskContent|contains: cmd.exe</Command>
    - TaskContent|contains: cmd</Command>
    - TaskContent|contains: '<Arguments>/c '
    - TaskContent|contains: '<Arguments>/k '
    - TaskContent|contains: '<Arguments>/r '
    - TaskContent|contains: powershell
    - TaskContent|contains: pwsh
    - TaskContent|contains: mshta
    - TaskContent|contains: wscript
    - TaskContent|contains: cscript
    - TaskContent|contains: certutil
    - TaskContent|contains: bitsadmin
    - TaskContent|contains: bash.exe
    - TaskContent|contains: 'bash '
    - TaskContent|contains: scrcons
    - TaskContent|contains: 'wmic '
    - TaskContent|contains: wmic.exe
    - TaskContent|contains: forfiles
    - TaskContent|contains: scriptrunner
    - TaskContent|contains: hh.exe
falsepositives:
- Unknown
level: high
