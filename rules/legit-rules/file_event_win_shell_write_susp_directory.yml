title: Windows Shell/Scripting Application File Write to Suspicious Folder
id: 1277f594-a7d1-4f28-a2d3-73af5cbeab43
status: test
description: Detects Windows shells and scripting applications that write files to
  suspicious folders
references:
- Internal Research
author: Florian Roth (Nextron Systems)
date: 2021/11/20
modified: 2023/03/29
tags:
- attack.execution
- attack.t1059
logsource:
  category: file_event
  product: windows
detection:
- and:
  - or:
    - or:
      - Image|endswith: \bash.exe
      - Image|endswith: \cmd.exe
      - Image|endswith: \cscript.exe
      - Image|endswith: \msbuild.exe
      - Image|endswith: \powershell.exe
      - Image|endswith: \pwsh.exe
      - Image|endswith: \sh.exe
      - Image|endswith: \wscript.exe
    - or:
      - TargetFilename|startswith: C:\PerfLogs\
      - TargetFilename|startswith: C:\Users\Public\
  - or:
    - or:
      - Image|endswith: \certutil.exe
      - Image|endswith: \forfiles.exe
      - Image|endswith: \mshta.exe
      - Image|endswith: \schtasks.exe
      - Image|endswith: \scriptrunner.exe
      - Image|endswith: \wmic.exe
    - or:
      - TargetFilename|contains: C:\PerfLogs\
      - TargetFilename|contains: C:\Users\Public\
      - TargetFilename|contains: C:\Windows\Temp\
falsepositives:
- Unknown
level: high
