title: Suspicious Scheduled Task Creation via Masqueraded XML File
id: dd2a821e-3b07-4d3b-a9ac-929fe4c6ca0c
status: test
description: Detects the creation of a scheduled task using the "-XML" flag with a
  file without the '.xml' extension. This behavior could be indicative of potential
  defense evasion attempt during persistence
references:
- https://docs.microsoft.com/en-us/windows/win32/taskschd/daily-trigger-example--xml-
- https://github.com/elastic/protections-artifacts/blob/084067123d3328a823b1c3fdde305b694275c794/behavior/rules/persistence_suspicious_scheduled_task_creation_via_masqueraded_xml_file.toml
author: Swachchhanda Shrawan Poudel, Elastic (idea)
date: 2023/04/20
tags:
- attack.defense_evasion
- attack.persistence
- attack.t1036.005
- attack.t1053.005
logsource:
  product: windows
  category: process_creation
detection:
- and:
  - or:
    - Image|endswith: \schtasks.exe
    - OriginalFileName|==: schtasks.exe
  - or:
    - CommandLine|contains: /create
    - CommandLine|contains: -create
  - or:
    - CommandLine|contains: /xml
    - CommandLine|contains: -xml
  - or:
    - CommandLine|not contains: .xml
  - or:
    - IntegrityLevel|!==: System
  - or:
    - ParentImage|not endswith: \rundll32.exe
    - ParentCommandLine|not contains: :\WINDOWS\Installer\MSI
    - ParentCommandLine|not contains: .tmp,zzzzInvokeManagedCustomActionOutOfProc
  - ParentImage|not endswith: :\ProgramData\OEM\UpgradeTool\CareCenter_*\BUnzip\Setup_msi.exe
  - ParentImage|not endswith: :\Program Files\Axis Communications\AXIS Camera Station\SetupActions.exe
  - ParentImage|not endswith: :\Program Files\Axis Communications\AXIS Device Manager\AdmSetupActions.exe
  - ParentImage|not endswith: :\Program Files (x86)\Zemana\AntiMalware\AntiMalware.exe
  - ParentImage|not endswith: :\Program Files\Dell\SupportAssist\pcdrcui.exe
falsepositives:
- Unknown
level: medium
