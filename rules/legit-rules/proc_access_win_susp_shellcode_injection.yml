title: Potential Shellcode Injection
id: 250ae82f-736e-4844-a68b-0b5e8cc887da
status: test
description: Detects potential shellcode injection used by tools such as Metasploit's
  migrate and Empire's psinject
references:
- https://github.com/EmpireProject/PSInject
author: Bhabesh Raj
date: 2022/03/11
modified: 2023/11/29
tags:
- attack.defense_evasion
- attack.privilege_escalation
- attack.t1055
logsource:
  category: process_access
  product: windows
detection:
- and:
  - or:
    - GrantedAccess|==: '0x147a'
    - GrantedAccess|==: '0x1f3fff'
  - CallTrace|contains: UNKNOWN
  - SourceImage|not contains: :\Program Files\Dell\
  - SourceImage|not contains: :\Program Files (x86)\Dell\
  - or:
    - SourceImage|not endswith: :\Program Files (x86)\Dell\UpdateService\ServiceShell.exe
    - TargetImage|not endswith: :\Windows\Explorer.EXE
    - GrantedAccess|!==: '0x1F3FFF'
    - CallTrace|not startswith: ?:\Windows\System32\ntdll.dll
  - SourceImage|not endswith: :\Program Files\Microsoft Visual Studio\2022\Community\Common7\IDE\PerfWatson2.exe
  - SourceImage|not endswith: :\Program Files (x86)\Microsoft Visual Studio\2019\Community\Common7\IDE\PerfWatson2.exe
  - or:
    - SourceImage|not contains: :\Program Files\Microsoft Visual Studio\
    - SourceImage|not endswith: \MSBuild\Current\Bin\MSBuild.exe
    - TargetImage|not endswith: :\Program Files\Dell\DellDataVault\DDVDataCollector.exe
  - or:
    - SourceImage|not endswith: :\Windows\System32\Wbem\Wmiprvse.exe
    - TargetImage|not endswith: :\Windows\system32\lsass.exe
    - CallTrace|not startswith: ?:\Windows\SYSTEM32\ntdll.dll
falsepositives:
- Unknown
level: high
