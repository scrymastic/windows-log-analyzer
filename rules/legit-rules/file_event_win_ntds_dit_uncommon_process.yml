title: NTDS.DIT Creation By Uncommon Process
id: 11b1ed55-154d-4e82-8ad7-83739298f720
related:
- id: 4e7050dd-e548-483f-b7d6-527ab4fa784d
  type: similar
status: test
description: Detects creation of a file named "ntds.dit" (Active Directory Database)
  by an uncommon process or a process located in a suspicious directory
references:
- https://stealthbits.com/blog/extracting-password-hashes-from-the-ntds-dit-file/
- https://adsecurity.org/?p=2398
author: Florian Roth (Nextron Systems), Nasreddine Bencherchali (Nextron Systems)
date: 2022/01/11
modified: 2022/07/14
tags:
- attack.credential_access
- attack.t1003.002
- attack.t1003.003
logsource:
  product: windows
  category: file_event
detection:
- selection_ntds:
  - and:
    - TargetFilename|endswith: \ntds.dit
- selection_process_img:
  - and:
    - or:
      - Image|endswith: \cmd.exe
      - Image|endswith: \cscript.exe
      - Image|endswith: \mshta.exe
      - Image|endswith: \powershell.exe
      - Image|endswith: \pwsh.exe
      - Image|endswith: \regsvr32.exe
      - Image|endswith: \rundll32.exe
      - Image|endswith: \wscript.exe
      - Image|endswith: \wsl.exe
      - Image|endswith: \wt.exe
- selection_process_paths:
  - and:
    - or:
      - Image|contains: \AppData\
      - Image|contains: \Temp\
      - Image|contains: \Public\
      - Image|contains: \PerfLogs\
- condition: selection_ntds and 1 of selection_process_*
falsepositives:
- Unknown
level: high
