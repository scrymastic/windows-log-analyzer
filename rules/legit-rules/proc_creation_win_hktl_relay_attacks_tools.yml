title: Potential SMB Relay Attack Tool Execution
id: 5589ab4f-a767-433c-961d-c91f3f704db1
status: test
description: Detects different hacktools used for relay attacks on Windows for privilege
  escalation
references:
- https://foxglovesecurity.com/2016/09/26/rotten-potato-privilege-escalation-from-service-accounts-to-system/
- https://pentestlab.blog/2017/04/13/hot-potato/
- https://github.com/ohpe/juicy-potato
- https://hunter2.gitbook.io/darthsidious/other/war-stories/domain-admin-in-30-minutes
- https://hunter2.gitbook.io/darthsidious/execution/responder-with-ntlm-relay-and-empire
- https://www.localpotato.com/
author: Florian Roth (Nextron Systems)
date: 2021/07/24
modified: 2023/02/14
tags:
- attack.execution
- attack.t1557.001
logsource:
  category: process_creation
  product: windows
detection:
- and:
  - or:
    - or:
      - Image|contains: PetitPotam
      - Image|contains: RottenPotato
      - Image|contains: HotPotato
      - Image|contains: JuicyPotato
      - Image|contains: \just_dce_
      - Image|contains: Juicy Potato
      - Image|contains: \temp\rot.exe
      - Image|contains: \Potato.exe
      - Image|contains: \SpoolSample.exe
      - Image|contains: \Responder.exe
      - Image|contains: \smbrelayx
      - Image|contains: \ntlmrelayx
      - Image|contains: \LocalPotato
  - or:
    - or:
      - CommandLine|contains: Invoke-Tater
      - CommandLine|contains: ' smbrelay'
      - CommandLine|contains: ' ntlmrelay'
      - CommandLine|contains: 'cme smb '
      - CommandLine|contains: ' /ntlm:NTLMhash '
      - CommandLine|contains: Invoke-PetitPotam
      - CommandLine|contains: '.exe -t * -p '
  - or:
    - CommandLine|contains: .exe -c "{
    - CommandLine|endswith: '}" -z'
  - or:
    - Image|contains: HotPotatoes6
    - Image|contains: HotPotatoes7
    - Image|contains: 'HotPotatoes '
falsepositives:
- Legitimate files with these rare hacktool names
level: critical
