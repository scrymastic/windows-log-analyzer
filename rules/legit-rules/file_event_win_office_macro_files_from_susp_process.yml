title: Office Macro File Creation From Suspicious Process
id: b1c50487-1967-4315-a026-6491686d860e
status: test
description: Detects the creation of a office macro file from a a suspicious process
references:
- https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1566.001/T1566.001.md
- https://docs.microsoft.com/en-us/deployoffice/compat/office-file-format-reference
author: frack113, Nasreddine Bencherchali (Nextron Systems)
date: 2022/01/23
modified: 2023/02/22
tags:
- attack.initial_access
- attack.t1566.001
logsource:
  category: file_event
  product: windows
  definition: 'Requirements: The "ParentImage" field is not available by default on
    EID 11 of Sysmon logs. To be able to use this rule to the full extent you need
    to enriche the log with additional ParentImage data'
detection:
- and:
  - or:
    - or:
      - Image|endswith: \cscript.exe
      - Image|endswith: \mshta.exe
      - Image|endswith: \regsvr32.exe
      - Image|endswith: \rundll32.exe
      - Image|endswith: \wscript.exe
    - or:
      - ParentImage|endswith: \cscript.exe
      - ParentImage|endswith: \mshta.exe
      - ParentImage|endswith: \regsvr32.exe
      - ParentImage|endswith: \rundll32.exe
      - ParentImage|endswith: \wscript.exe
  - or:
    - TargetFilename|endswith: .docm
    - TargetFilename|endswith: .dotm
    - TargetFilename|endswith: .xlsm
    - TargetFilename|endswith: .xltm
    - TargetFilename|endswith: .potm
    - TargetFilename|endswith: .pptm
falsepositives:
- Unknown
level: high
