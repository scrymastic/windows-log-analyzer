title: Potential Persistence Via Microsoft Office Startup Folder
id: 0e20c89d-2264-44ae-8238-aeeaba609ece
status: test
description: Detects creation of Microsoft Office files inside of one of the default
  startup folders in order to achieve persistence.
references:
- https://insight-jp.nttsecurity.com/post/102hojk/operation-restylink-apt-campaign-targeting-japanese-companies
- https://learn.microsoft.com/en-us/office/troubleshoot/excel/use-startup-folders
author: Max Altgelt (Nextron Systems), Nasreddine Bencherchali (Nextron Systems)
date: 2022/06/02
modified: 2023/06/22
tags:
- attack.persistence
- attack.t1137
logsource:
  category: file_event
  product: windows
detection:
- selection_word_paths:
  - and:
    - or:
      - TargetFilename|contains: \Microsoft\Word\STARTUP
      - and:
        - TargetFilename|contains: \Office
        - TargetFilename|contains: \Program Files
        - TargetFilename|contains: \STARTUP
- selection_word_extension:
  - and:
    - or:
      - TargetFilename|endswith: .doc
      - TargetFilename|endswith: .docm
      - TargetFilename|endswith: .docx
      - TargetFilename|endswith: .dot
      - TargetFilename|endswith: .dotm
      - TargetFilename|endswith: .rtf
- selection_excel_paths:
  - and:
    - or:
      - TargetFilename|contains: \Microsoft\Excel\XLSTART
      - and:
        - TargetFilename|contains: \Office
        - TargetFilename|contains: \Program Files
        - TargetFilename|contains: \XLSTART
- selection_excel_extension:
  - and:
    - or:
      - TargetFilename|endswith: .xls
      - TargetFilename|endswith: .xlsm
      - TargetFilename|endswith: .xlsx
      - TargetFilename|endswith: .xlt
      - TargetFilename|endswith: .xltm
- filter_main_office:
  - and:
    - or:
      - Image|endswith: \WINWORD.exe
      - Image|endswith: \EXCEL.exe
- condition: (all of selection_word_* or all of selection_excel_*) and not filter_main_office
falsepositives:
- Loading a user environment from a backup or a domain controller
- Synchronization of templates
level: high
