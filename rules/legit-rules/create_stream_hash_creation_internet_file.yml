title: Creation Of a Suspicious ADS File Outside a Browser Download
id: 573df571-a223-43bc-846e-3f98da481eca
status: experimental
description: Detects the creation of a suspicious ADS (Alternate Data Stream) file
  by software other than browsers
references:
- https://www.bleepingcomputer.com/news/security/exploited-windows-zero-day-lets-javascript-files-bypass-security-warnings/
author: frack113
date: 2022/10/22
modified: 2023/06/12
tags:
- attack.defense_evasion
logsource:
  product: windows
  category: create_stream_hash
detection:
- selection:
  - and:
    - Contents|startswith: '[ZoneTransfer]  ZoneId=3'
    - TargetFilename|endswith: :Zone.Identifier
    - or:
      - TargetFilename|contains: .exe
      - TargetFilename|contains: .scr
      - TargetFilename|contains: .bat
      - TargetFilename|contains: .cmd
      - TargetFilename|contains: .docx
      - TargetFilename|contains: .hta
      - TargetFilename|contains: .jse
      - TargetFilename|contains: .lnk
      - TargetFilename|contains: .pptx
      - TargetFilename|contains: .ps
      - TargetFilename|contains: .reg
      - TargetFilename|contains: .sct
      - TargetFilename|contains: .vb
      - TargetFilename|contains: .wsc
      - TargetFilename|contains: .wsf
      - TargetFilename|contains: .xlsx
- filter_optional_brave:
  - and:
    - Image|endswith: \brave.exe
- filter_optional_chrome:
  - and:
    - or:
      - Image|==: C:\Program Files\Google\Chrome\Application\chrome.exe
      - Image|==: C:\Program Files (x86)\Google\Chrome\Application\chrome.exe
- filter_optional_firefox:
  - and:
    - or:
      - Image|==: C:\Program Files\Mozilla Firefox\firefox.exe
      - Image|==: C:\Program Files (x86)\Mozilla Firefox\firefox.exe
- filter_optional_ie:
  - and:
    - or:
      - Image|==: C:\Program Files (x86)\Internet Explorer\iexplore.exe
      - Image|==: C:\Program Files\Internet Explorer\iexplore.exe
- filter_optional_maxthon:
  - and:
    - Image|endswith: \maxthon.exe
- filter_optional_edge_1:
  - and:
    - or:
      - Image|startswith: C:\Program Files (x86)\Microsoft\EdgeWebView\Application\
      - Image|endswith: \WindowsApps\MicrosoftEdge.exe
      - or:
        - Image|==: C:\Program Files (x86)\Microsoft\Edge\Application\msedge.exe
        - Image|==: C:\Program Files\Microsoft\Edge\Application\msedge.exe
- filter_optional_edge_2:
  - and:
    - or:
      - Image|startswith: C:\Program Files (x86)\Microsoft\EdgeCore\
      - Image|startswith: C:\Program Files\Microsoft\EdgeCore\
    - or:
      - Image|endswith: \msedge.exe
      - Image|endswith: \msedgewebview2.exe
- filter_optional_opera:
  - and:
    - Image|endswith: \opera.exe
- filter_optional_safari:
  - and:
    - Image|endswith: \safari.exe
- filter_optional_seamonkey:
  - and:
    - Image|endswith: \seamonkey.exe
- filter_optional_vivaldi:
  - and:
    - Image|endswith: \vivaldi.exe
- filter_optional_whale:
  - and:
    - Image|endswith: \whale.exe
- filter_optional_snipping_tool:
  - and:
    - Image|startswith: C:\Program Files\WindowsApps\Microsoft.ScreenSketch_
    - Image|endswith: \SnippingTool\SnippingTool.exe
    - TargetFilename|startswith: C:\Users\
    - TargetFilename|contains: \AppData\Local\Packages\Microsoft.ScreenSketch_
    - TargetFilename|contains: '\TempState\Screenshot '
    - TargetFilename|endswith: .png:Zone.Identifier
- condition: selection and not 1 of filter_optional_*
falsepositives:
- Other legitimate browsers not currently included in the filter (please add them)
- Legitimate downloads via scripting or command-line tools (Investigate to determine
  if it's legitimate)
level: medium
