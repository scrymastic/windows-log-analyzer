title: HackTool - KrbRelayUp Execution
id: 12827a56-61a4-476a-a9cb-f3068f191073
status: test
description: Detects KrbRelayUp used to perform a universal no-fix local privilege
  escalation in Windows domain environments where LDAP signing is not enforced
references:
- https://github.com/Dec0ne/KrbRelayUp
author: Florian Roth (Nextron Systems)
date: 2022/04/26
modified: 2023/02/04
tags:
- attack.credential_access
- attack.t1558.003
- attack.lateral_movement
- attack.t1550.003
logsource:
  category: process_creation
  product: windows
detection:
- selection_img:
  - and:
    - or:
      - Image|endswith: \KrbRelayUp.exe
      - OriginalFileName|==: KrbRelayUp.exe
- selection_cli_1:
  - and:
    - CommandLine|contains: ' relay '
    - CommandLine|contains: ' -Domain '
    - CommandLine|contains: ' -ComputerName '
- selection_cli_2:
  - and:
    - CommandLine|contains: ' krbscm '
    - CommandLine|contains: ' -sc '
- selection_cli_3:
  - and:
    - CommandLine|contains: ' spawn '
    - CommandLine|contains: ' -d '
    - CommandLine|contains: ' -cn '
    - CommandLine|contains: ' -cp '
- condition: 1 of selection_*
falsepositives:
- Unlikely
level: high
