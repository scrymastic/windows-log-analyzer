title: Potential Persistence Via Custom Protocol Handler
id: fdbf0b9d-0182-4c43-893b-a1eaab92d085
status: test
description: Detects potential persistence activity via the registering of a new custom
  protocole handlers. While legitimate applications register protocole handlers often
  times during installation. And attacker can abuse this by setting a custom handler
  to be used as a persistence mechanism.
references:
- https://ladydebug.com/blog/2019/06/21/custom-protocol-handler-cph/
author: Nasreddine Bencherchali (Nextron Systems)
date: 2022/05/30
modified: 2023/05/12
tags:
- attack.defense_evasion
- attack.t1112
logsource:
  category: registry_set
  product: windows
detection:
- and:
  - TargetObject|startswith: HKCR\
  - Details|startswith: 'URL:'
  - or:
    - Details|not startswith: URL:ms-
  - Image|not startswith: C:\Program Files (x86)
  - Image|not startswith: C:\Program Files\
  - Image|not startswith: C:\Windows\System32\
  - Image|not startswith: C:\Windows\SysWOW64\
falsepositives:
- Many legitimate applications can register a new custom protocol handler. Additional
  filters needs to applied according to your environment.
level: medium
