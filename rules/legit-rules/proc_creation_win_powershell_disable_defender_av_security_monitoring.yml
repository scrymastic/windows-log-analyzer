title: Disable Windows Defender AV Security Monitoring
id: a7ee1722-c3c5-aeff-3212-c777e4733217
status: test
description: Detects attackers attempting to disable Windows Defender using Powershell
references:
- https://research.nccgroup.com/2020/06/23/wastedlocker-a-new-ransomware-variant-developed-by-the-evil-corp-group/
- https://rvsec0n.wordpress.com/2020/01/24/malwares-that-bypass-windows-defender/
- https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1562.001/T1562.001.md
author: ok @securonix invrep-de, oscd.community, frack113
date: 2020/10/12
modified: 2022/11/18
tags:
- attack.defense_evasion
- attack.t1562.001
logsource:
  category: process_creation
  product: windows
detection:
- and:
  - or:
    - or:
      - Image|endswith: \powershell.exe
      - Image|endswith: \pwsh.exe
    - or:
      - OriginalFileName|==: PowerShell.EXE
      - OriginalFileName|==: pwsh.dll
  - or:
    - CommandLine|contains: -DisableBehaviorMonitoring $true
    - CommandLine|contains: -DisableRuntimeMonitoring $true
  - or:
    - Image|endswith: \sc.exe
    - OriginalFileName|==: sc.exe
  - CommandLine|contains: stop
  - CommandLine|contains: WinDefend
  - CommandLine|contains: delete
  - CommandLine|contains: WinDefend
  - CommandLine|contains: config
  - CommandLine|contains: WinDefend
  - CommandLine|contains: start=disabled
falsepositives:
- Minimal, for some older versions of dev tools, such as pycharm, developers were
  known to sometimes disable Windows Defender to improve performance, but this generally
  is not considered a good security practice.
level: high
