title: Csc.EXE Execution Form Potentially Suspicious Parent
id: b730a276-6b63-41b8-bcf8-55930c8fc6ee
status: test
description: Detects a potentially suspicious parent of "csc.exe", which could be
  a sign of payload delivery.
references:
- https://www.uptycs.com/blog/warzonerat-can-now-evade-with-process-hollowing
- https://reaqta.com/2017/11/short-journey-darkvnc/
- https://www.pwc.com/gx/en/issues/cybersecurity/cyber-threat-intelligence/yellow-liderc-ships-its-scripts-delivers-imaploader-malware.html
author: Florian Roth (Nextron Systems), Nasreddine Bencherchali (Nextron Systems),
  X__Junior (Nextron Systems)
date: 2019/02/11
modified: 2023/10/27
tags:
- attack.execution
- attack.t1059.005
- attack.t1059.007
- attack.defense_evasion
- attack.t1218.005
- attack.t1027.004
logsource:
  category: process_creation
  product: windows
detection:
- selection_img:
  - and:
    - or:
      - Image|endswith: \csc.exe
      - OriginalFileName|==: csc.exe
- selection_parent_generic:
  - and:
    - or:
      - ParentImage|endswith: \cscript.exe
      - ParentImage|endswith: \excel.exe
      - ParentImage|endswith: \mshta.exe
      - ParentImage|endswith: \onenote.exe
      - ParentImage|endswith: \outlook.exe
      - ParentImage|endswith: \powerpnt.exe
      - ParentImage|endswith: \winword.exe
      - ParentImage|endswith: \wscript.exe
- selection_parent_powershell:
  - and:
    - or:
      - ParentImage|endswith: \powershell.exe
      - ParentImage|endswith: \pwsh.exe
    - or:
      - ParentCommandLine|contains: '-Encoded '
      - ParentCommandLine|contains: FromBase64String
- selection_parent_susp_location:
  - and:
    - or:
      - ParentCommandLine|matches: ([Pp]rogram[Dd]ata|%([Ll]ocal)?[Aa]pp[Dd]ata%|\\[Aa]pp[Dd]ata\\([Ll]ocal(Ll]ow)?|[Rr]oaming))\\[^\\]{1,256}$
      - or:
        - ParentCommandLine|contains: :\PerfLogs\
        - ParentCommandLine|contains: :\Users\Public\
        - ParentCommandLine|contains: :\Windows\Temp\
        - ParentCommandLine|contains: \Temporary Internet
      - and:
        - ParentCommandLine|contains: :\Users\
        - ParentCommandLine|contains: \Favorites\
      - and:
        - ParentCommandLine|contains: :\Users\
        - ParentCommandLine|contains: \Favourites\
      - and:
        - ParentCommandLine|contains: :\Users\
        - ParentCommandLine|contains: \Contacts\
      - and:
        - ParentCommandLine|contains: :\Users\
        - ParentCommandLine|contains: \Pictures\
- filter_main_programfiles:
  - and:
    - or:
      - ParentImage|startswith: C:\Program Files (x86)\
      - ParentImage|startswith: C:\Program Files\
- filter_main_sdiagnhost:
  - and:
    - ParentImage|==: C:\Windows\System32\sdiagnhost.exe
- filter_main_w3p:
  - and:
    - ParentImage|==: C:\Windows\System32\inetsrv\w3wp.exe
- filter_optional_chocolatey:
  - and:
    - ParentImage|==: C:\ProgramData\chocolatey\choco.exe
- filter_optional_defender:
  - and:
    - ParentCommandLine|contains: \ProgramData\Microsoft\Windows Defender Advanced
        Threat Protection
- filter_optional_ansible:
  - and:
    - or:
      - ParentCommandLine|contains: JwB7ACIAZgBhAGkAbABlAGQAIgA6AHQAcgB1AGUALAAiAG0AcwBnACIAOgAiAEEAbgBzAGkAYgBsAGUAIAByAGUAcQB1AGkAcgBlAHMAIABQAG8AdwBlAHIAUwBoAGUAbABsACAAdgAzAC4AMAAgAG8AcgAgAG4AZQB3AGUAcgAiAH0AJw
      - ParentCommandLine|contains: cAewAiAGYAYQBpAGwAZQBkACIAOgB0AHIAdQBlACwAIgBtAHMAZwAiADoAIgBBAG4AcwBpAGIAbABlACAAcgBlAHEAdQBpAHIAZQBzACAAUABvAHcAZQByAFMAaABlAGwAbAAgAHYAMwAuADAAIABvAHIAIABuAGUAdwBlAHIAIgB9ACcA
      - ParentCommandLine|contains: nAHsAIgBmAGEAaQBsAGUAZAAiADoAdAByAHUAZQAsACIAbQBzAGcAIgA6ACIAQQBuAHMAaQBiAGwAZQAgAHIAZQBxAHUAaQByAGUAcwAgAFAAbwB3AGUAcgBTAGgAZQBsAGwAIAB2ADMALgAwACAAbwByACAAbgBlAHcAZQByACIAfQAnA
- condition: selection_img and 1 of selection_parent_* and not 1 of filter_main_*
    and not 1 of filter_optional_*
falsepositives:
- Unknown
level: high
