title: Potential Binary Or Script Dropper Via PowerShell
id: 7047d730-036f-4f40-b9d8-1c63e36d5e62
status: test
description: Detects PowerShell creating a binary executable or a script file.
references:
- https://www.zscaler.com/blogs/security-research/onenote-growing-threat-malware-distribution
author: frack113, Nasreddine Bencherchali (Nextron Systems)
date: 2023/03/17
modified: 2023/05/09
tags:
- attack.persistence
logsource:
  product: windows
  category: file_event
detection:
- selection:
  - and:
    - or:
      - Image|endswith: \powershell.exe
      - Image|endswith: \pwsh.exe
    - or:
      - TargetFilename|endswith: .bat
      - TargetFilename|endswith: .chm
      - TargetFilename|endswith: .cmd
      - TargetFilename|endswith: .com
      - TargetFilename|endswith: .dll
      - TargetFilename|endswith: .exe
      - TargetFilename|endswith: .hta
      - TargetFilename|endswith: .jar
      - TargetFilename|endswith: .js
      - TargetFilename|endswith: .ocx
      - TargetFilename|endswith: .scr
      - TargetFilename|endswith: .sys
      - TargetFilename|endswith: .vbe
      - TargetFilename|endswith: .vbs
      - TargetFilename|endswith: .wsf
- filter_main_user_temp:
  - and:
    - TargetFilename|startswith: C:\Users\
    - TargetFilename|contains: \AppData\Local\Temp\
    - or:
      - TargetFilename|endswith: .dll
      - TargetFilename|endswith: .exe
- filter_main_admin_temp:
  - and:
    - TargetFilename|startswith: C:\Windows\Temp\
    - or:
      - TargetFilename|endswith: .dll
      - TargetFilename|endswith: .exe
- condition: selection and not 1 of filter_main_*
falsepositives:
- False positives will differ depending on the environment and scripts used. Apply
  additional filters accordingly.
level: medium
