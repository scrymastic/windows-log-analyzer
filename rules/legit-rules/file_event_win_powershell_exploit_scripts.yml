title: Malicious PowerShell Scripts - FileCreation
id: f331aa1f-8c53-4fc3-b083-cc159bc971cb
related:
- id: 41025fd7-0466-4650-a813-574aaacbe7f4
  type: similar
status: test
description: Detects the creation of known offensive powershell scripts used for exploitation
references:
- https://github.com/PowerShellMafia/PowerSploit
- https://github.com/NetSPI/PowerUpSQL
- https://github.com/CsEnox/EventViewer-UACBypass
- https://github.com/AlsidOfficial/WSUSpendu/
- https://github.com/nettitude/Invoke-PowerThIEf
- https://github.com/S3cur3Th1sSh1t/WinPwn
- https://github.com/S3cur3Th1sSh1t/PowerSharpPack/tree/master/PowerSharpBinaries
- https://github.com/BC-SECURITY/Invoke-ZeroLogon/blob/111d17c7fec486d9bb23387e2e828b09a26075e4/Invoke-ZeroLogon.ps1
- https://github.com/xorrior/RandomPS-Scripts/blob/848c919bfce4e2d67b626cbcf4404341cfe3d3b6/Get-DXWebcamVideo.ps1
- https://github.com/rvrsh3ll/Misc-Powershell-Scripts/blob/6f23bb41f9675d7e2d32bacccff75e931ae00554/OfficeMemScraper.ps1
- https://github.com/dafthack/DomainPasswordSpray/blob/b13d64a5834694aa73fd2aea9911a83027c465a7/DomainPasswordSpray.ps1
- https://unit42.paloaltonetworks.com/threat-assessment-black-basta-ransomware/
- https://research.nccgroup.com/2022/06/06/shining-the-light-on-black-basta/
- https://github.com/HarmJ0y/DAMP
- https://github.com/samratashok/nishang
- https://github.com/DarkCoderSc/PowerRunAsSystem/
- https://github.com/besimorhino/powercat
- https://github.com/Kevin-Robertson/Powermad
- https://github.com/adrecon/ADRecon
- https://github.com/adrecon/AzureADRecon
author: Markus Neis, Nasreddine Bencherchali (Nextron Systems), Mustafa Kaan Demir,
  Georg Lauenstein
date: 2018/04/07
modified: 2024/01/25
tags:
- attack.execution
- attack.t1059.001
logsource:
  category: file_event
  product: windows
detection:
- selection_generic:
  - and:
    - or:
      - TargetFilename|endswith: \Add-ConstrainedDelegationBackdoor.ps1
      - TargetFilename|endswith: \Add-Exfiltration.ps1
      - TargetFilename|endswith: \Add-Persistence.ps1
      - TargetFilename|endswith: \Add-RegBackdoor.ps1
      - TargetFilename|endswith: \Add-RemoteRegBackdoor.ps1
      - TargetFilename|endswith: \Add-ScrnSaveBackdoor.ps1
      - TargetFilename|endswith: \ADRecon.ps1
      - TargetFilename|endswith: \AzureADRecon.ps1
      - TargetFilename|endswith: \Check-VM.ps1
      - TargetFilename|endswith: \ConvertTo-ROT13.ps1
      - TargetFilename|endswith: \Copy-VSS.ps1
      - TargetFilename|endswith: \Create-MultipleSessions.ps1
      - TargetFilename|endswith: \DNS_TXT_Pwnage.ps1
      - TargetFilename|endswith: \dnscat2.ps1
      - TargetFilename|endswith: \Do-Exfiltration.ps1
      - TargetFilename|endswith: \DomainPasswordSpray.ps1
      - TargetFilename|endswith: \Download_Execute.ps1
      - TargetFilename|endswith: \Download-Execute-PS.ps1
      - TargetFilename|endswith: \Enable-DuplicateToken.ps1
      - TargetFilename|endswith: \Enabled-DuplicateToken.ps1
      - TargetFilename|endswith: \Execute-Command-MSSQL.ps1
      - TargetFilename|endswith: \Execute-DNSTXT-Code.ps1
      - TargetFilename|endswith: \Execute-OnTime.ps1
      - TargetFilename|endswith: \ExetoText.ps1
      - TargetFilename|endswith: \Exploit-Jboss.ps1
      - TargetFilename|endswith: \Find-AVSignature.ps1
      - TargetFilename|endswith: \Find-Fruit.ps1
      - TargetFilename|endswith: \Find-GPOLocation.ps1
      - TargetFilename|endswith: \Find-TrustedDocuments.ps1
      - TargetFilename|endswith: \FireBuster.ps1
      - TargetFilename|endswith: \FireListener.ps1
      - TargetFilename|endswith: \Get-ApplicationHost.ps1
      - TargetFilename|endswith: \Get-ChromeDump.ps1
      - TargetFilename|endswith: \Get-ClipboardContents.ps1
      - TargetFilename|endswith: \Get-ComputerDetail.ps1
      - TargetFilename|endswith: \Get-FoxDump.ps1
      - TargetFilename|endswith: \Get-GPPAutologon.ps1
      - TargetFilename|endswith: \Get-GPPPassword.ps1
      - TargetFilename|endswith: \Get-IndexedItem.ps1
      - TargetFilename|endswith: \Get-Keystrokes.ps1
      - TargetFilename|endswith: \Get-LSASecret.ps1
      - TargetFilename|endswith: \Get-MicrophoneAudio.ps1
      - TargetFilename|endswith: \Get-PassHashes.ps1
      - TargetFilename|endswith: \Get-PassHints.ps1
      - TargetFilename|endswith: \Get-RegAlwaysInstallElevated.ps1
      - TargetFilename|endswith: \Get-RegAutoLogon.ps1
      - TargetFilename|endswith: \Get-RickAstley.ps1
      - TargetFilename|endswith: \Get-Screenshot.ps1
      - TargetFilename|endswith: \Get-SecurityPackages.ps1
      - TargetFilename|endswith: \Get-ServiceFilePermission.ps1
      - TargetFilename|endswith: \Get-ServicePermission.ps1
      - TargetFilename|endswith: \Get-ServiceUnquoted.ps1
      - TargetFilename|endswith: \Get-SiteListPassword.ps1
      - TargetFilename|endswith: \Get-System.ps1
      - TargetFilename|endswith: \Get-TimedScreenshot.ps1
      - TargetFilename|endswith: \Get-UnattendedInstallFile.ps1
      - TargetFilename|endswith: \Get-Unconstrained.ps1
      - TargetFilename|endswith: \Get-USBKeystrokes.ps1
      - TargetFilename|endswith: \Get-VaultCredential.ps1
      - TargetFilename|endswith: \Get-VulnAutoRun.ps1
      - TargetFilename|endswith: \Get-VulnSchTask.ps1
      - TargetFilename|endswith: \Get-WebConfig.ps1
      - TargetFilename|endswith: \Get-WebCredentials.ps1
      - TargetFilename|endswith: \Get-WLAN-Keys.ps1
      - TargetFilename|endswith: \Gupt-Backdoor.ps1
      - TargetFilename|endswith: \HTTP-Backdoor.ps1
      - TargetFilename|endswith: \HTTP-Login.ps1
      - TargetFilename|endswith: \Install-ServiceBinary.ps1
      - TargetFilename|endswith: \Install-SSP.ps1
      - TargetFilename|endswith: \Invoke-ACLScanner.ps1
      - TargetFilename|endswith: \Invoke-ADSBackdoor.ps1
      - TargetFilename|endswith: \Invoke-AmsiBypass.ps1
      - TargetFilename|endswith: \Invoke-ARPScan.ps1
      - TargetFilename|endswith: \Invoke-BackdoorLNK.ps1
      - TargetFilename|endswith: \Invoke-BadPotato.ps1
      - TargetFilename|endswith: \Invoke-BetterSafetyKatz.ps1
      - TargetFilename|endswith: \Invoke-BruteForce.ps1
      - TargetFilename|endswith: \Invoke-BypassUAC.ps1
      - TargetFilename|endswith: \Invoke-Carbuncle.ps1
      - TargetFilename|endswith: \Invoke-Certify.ps1
      - TargetFilename|endswith: \Invoke-ConPtyShell.ps1
      - TargetFilename|endswith: \Invoke-CredentialInjection.ps1
      - TargetFilename|endswith: \Invoke-CredentialsPhish.ps1
      - TargetFilename|endswith: \Invoke-DAFT.ps1
      - TargetFilename|endswith: \Invoke-DCSync.ps1
      - TargetFilename|endswith: \Invoke-Decode.ps1
      - TargetFilename|endswith: \Invoke-DinvokeKatz.ps1
      - TargetFilename|endswith: \Invoke-DllInjection.ps1
      - TargetFilename|endswith: \Invoke-DNSUpdate.ps1
      - TargetFilename|endswith: \Invoke-DowngradeAccount.ps1
      - TargetFilename|endswith: \Invoke-EgressCheck.ps1
      - TargetFilename|endswith: \Invoke-Encode.ps1
      - TargetFilename|endswith: \Invoke-EventViewer.ps1
      - TargetFilename|endswith: \Invoke-Eyewitness.ps1
      - TargetFilename|endswith: \Invoke-FakeLogonScreen.ps1
      - TargetFilename|endswith: \Invoke-Farmer.ps1
      - TargetFilename|endswith: \Invoke-Get-RBCD-Threaded.ps1
      - TargetFilename|endswith: \Invoke-Gopher.ps1
      - TargetFilename|endswith: \Invoke-Grouper2.ps1
      - TargetFilename|endswith: \Invoke-Grouper3.ps1
      - TargetFilename|endswith: \Invoke-HandleKatz.ps1
      - TargetFilename|endswith: \Invoke-Interceptor.ps1
      - TargetFilename|endswith: \Invoke-Internalmonologue.ps1
      - TargetFilename|endswith: \Invoke-Inveigh.ps1
      - TargetFilename|endswith: \Invoke-InveighRelay.ps1
      - TargetFilename|endswith: \Invoke-JSRatRegsvr.ps1
      - TargetFilename|endswith: \Invoke-JSRatRundll.ps1
      - TargetFilename|endswith: \Invoke-KrbRelay.ps1
      - TargetFilename|endswith: \Invoke-KrbRelayUp.ps1
      - TargetFilename|endswith: \Invoke-LdapSignCheck.ps1
      - TargetFilename|endswith: \Invoke-Lockless.ps1
      - TargetFilename|endswith: \Invoke-MalSCCM.ps1
      - TargetFilename|endswith: \Invoke-Mimikatz.ps1
      - TargetFilename|endswith: \Invoke-MimikatzWDigestDowngrade.ps1
      - TargetFilename|endswith: \Invoke-Mimikittenz.ps1
      - TargetFilename|endswith: \Invoke-MITM6.ps1
      - TargetFilename|endswith: \Invoke-NanoDump.ps1
      - TargetFilename|endswith: \Invoke-NetRipper.ps1
      - TargetFilename|endswith: \Invoke-NetworkRelay.ps1
      - TargetFilename|endswith: \Invoke-NinjaCopy.ps1
      - TargetFilename|endswith: \Invoke-OxidResolver.ps1
      - TargetFilename|endswith: \Invoke-P0wnedshell.ps1
      - TargetFilename|endswith: \Invoke-P0wnedshellx86.ps1
      - TargetFilename|endswith: \Invoke-Paranoia.ps1
      - TargetFilename|endswith: \Invoke-PortScan.ps1
      - TargetFilename|endswith: \Invoke-PoshRatHttp.ps1
      - TargetFilename|endswith: \Invoke-PoshRatHttps.ps1
      - TargetFilename|endswith: \Invoke-PostExfil.ps1
      - TargetFilename|endswith: \Invoke-PowerDump.ps1
      - TargetFilename|endswith: \Invoke-PowerShellIcmp.ps1
      - TargetFilename|endswith: \Invoke-PowerShellTCP.ps1
      - TargetFilename|endswith: \Invoke-PowerShellTcpOneLine.ps1
      - TargetFilename|endswith: \Invoke-PowerShellTcpOneLineBind.ps1
      - TargetFilename|endswith: \Invoke-PowerShellUdp.ps1
      - TargetFilename|endswith: \Invoke-PowerShellUdpOneLine.ps1
      - TargetFilename|endswith: \Invoke-PowerShellWMI.ps1
      - TargetFilename|endswith: \Invoke-PowerThIEf.ps1
      - TargetFilename|endswith: \Invoke-PPLDump.ps1
      - TargetFilename|endswith: \Invoke-Prasadhak.ps1
      - TargetFilename|endswith: \Invoke-PsExec.ps1
      - TargetFilename|endswith: \Invoke-PsGcat.ps1
      - TargetFilename|endswith: \Invoke-PsGcatAgent.ps1
      - TargetFilename|endswith: \Invoke-PSInject.ps1
      - TargetFilename|endswith: \Invoke-PsUaCme.ps1
      - TargetFilename|endswith: \Invoke-ReflectivePEInjection.ps1
      - TargetFilename|endswith: \Invoke-ReverseDNSLookup.ps1
      - TargetFilename|endswith: \Invoke-Rubeus.ps1
      - TargetFilename|endswith: \Invoke-RunAs.ps1
      - TargetFilename|endswith: \Invoke-SafetyKatz.ps1
      - TargetFilename|endswith: \Invoke-SauronEye.ps1
      - TargetFilename|endswith: \Invoke-SCShell.ps1
      - TargetFilename|endswith: \Invoke-Seatbelt.ps1
      - TargetFilename|endswith: \Invoke-ServiceAbuse.ps1
      - TargetFilename|endswith: \Invoke-SessionGopher.ps1
      - TargetFilename|endswith: \Invoke-ShellCode.ps1
      - TargetFilename|endswith: \Invoke-SMBScanner.ps1
      - TargetFilename|endswith: \Invoke-Snaffler.ps1
      - TargetFilename|endswith: \Invoke-Spoolsample.ps1
      - TargetFilename|endswith: \Invoke-SSHCommand.ps1
      - TargetFilename|endswith: \Invoke-SSIDExfil.ps1
      - TargetFilename|endswith: \Invoke-StandIn.ps1
      - TargetFilename|endswith: \Invoke-StickyNotesExtract.ps1
      - TargetFilename|endswith: \Invoke-Tater.ps1
      - TargetFilename|endswith: \Invoke-Thunderfox.ps1
      - TargetFilename|endswith: \Invoke-ThunderStruck.ps1
      - TargetFilename|endswith: \Invoke-TokenManipulation.ps1
      - TargetFilename|endswith: \Invoke-Tokenvator.ps1
      - TargetFilename|endswith: \Invoke-TotalExec.ps1
      - TargetFilename|endswith: \Invoke-UrbanBishop.ps1
      - TargetFilename|endswith: \Invoke-UserHunter.ps1
      - TargetFilename|endswith: \Invoke-VoiceTroll.ps1
      - TargetFilename|endswith: \Invoke-Whisker.ps1
      - TargetFilename|endswith: \Invoke-WinEnum.ps1
      - TargetFilename|endswith: \Invoke-winPEAS.ps1
      - TargetFilename|endswith: \Invoke-WireTap.ps1
      - TargetFilename|endswith: \Invoke-WmiCommand.ps1
      - TargetFilename|endswith: \Invoke-WScriptBypassUAC.ps1
      - TargetFilename|endswith: \Invoke-Zerologon.ps1
      - TargetFilename|endswith: \Keylogger.ps1
      - TargetFilename|endswith: \MailRaider.ps1
      - TargetFilename|endswith: \New-HoneyHash.ps1
      - TargetFilename|endswith: \OfficeMemScraper.ps1
      - TargetFilename|endswith: \Offline_Winpwn.ps1
      - TargetFilename|endswith: \Out-CHM.ps1
      - TargetFilename|endswith: \Out-DnsTxt.ps1
      - TargetFilename|endswith: \Out-Excel.ps1
      - TargetFilename|endswith: \Out-HTA.ps1
      - TargetFilename|endswith: \Out-Java.ps1
      - TargetFilename|endswith: \Out-JS.ps1
      - TargetFilename|endswith: \Out-Minidump.ps1
      - TargetFilename|endswith: \Out-RundllCommand.ps1
      - TargetFilename|endswith: \Out-SCF.ps1
      - TargetFilename|endswith: \Out-SCT.ps1
      - TargetFilename|endswith: \Out-Shortcut.ps1
      - TargetFilename|endswith: \Out-WebQuery.ps1
      - TargetFilename|endswith: \Out-Word.ps1
      - TargetFilename|endswith: \Parse_Keys.ps1
      - TargetFilename|endswith: \Port-Scan.ps1
      - TargetFilename|endswith: \PowerBreach.ps1
      - TargetFilename|endswith: \powercat.ps1
      - TargetFilename|endswith: \Powermad.ps1
      - TargetFilename|endswith: \PowerRunAsSystem.psm1
      - TargetFilename|endswith: \PowerSharpPack.ps1
      - TargetFilename|endswith: \PowerUp.ps1
      - TargetFilename|endswith: \PowerUpSQL.ps1
      - TargetFilename|endswith: \PowerView.ps1
      - TargetFilename|endswith: \PSAsyncShell.ps1
      - TargetFilename|endswith: \RemoteHashRetrieval.ps1
      - TargetFilename|endswith: \Remove-Persistence.ps1
      - TargetFilename|endswith: \Remove-PoshRat.ps1
      - TargetFilename|endswith: \Remove-Update.ps1
      - TargetFilename|endswith: \Run-EXEonRemote.ps1
      - TargetFilename|endswith: \Schtasks-Backdoor.ps1
      - TargetFilename|endswith: \Set-DCShadowPermissions.ps1
      - TargetFilename|endswith: \Set-MacAttribute.ps1
      - TargetFilename|endswith: \Set-RemotePSRemoting.ps1
      - TargetFilename|endswith: \Set-RemoteWMI.ps1
      - TargetFilename|endswith: \Set-Wallpaper.ps1
      - TargetFilename|endswith: \Show-TargetScreen.ps1
      - TargetFilename|endswith: \Speak.ps1
      - TargetFilename|endswith: \Start-CaptureServer.ps1
      - TargetFilename|endswith: \Start-WebcamRecorder.ps1
      - TargetFilename|endswith: \StringToBase64.ps1
      - TargetFilename|endswith: \TexttoExe.ps1
      - TargetFilename|endswith: \VolumeShadowCopyTools.ps1
      - TargetFilename|endswith: \WinPwn.ps1
      - TargetFilename|endswith: \WSUSpendu.ps1
- selection_invoke_sharp:
  - and:
    - TargetFilename|contains: Invoke-Sharp
    - TargetFilename|endswith: .ps1
- condition: 1 of selection_*
falsepositives:
- Unknown
level: high
