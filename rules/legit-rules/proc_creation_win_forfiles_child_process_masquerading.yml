title: Forfiles.EXE Child Process Masquerading
id: f53714ec-5077-420e-ad20-907ff9bb2958
status: experimental
description: 'Detects the execution of "forfiles" from a non-default location, in
  order to potentially spawn a custom "cmd.exe" from the current working directory.

  '
references:
- https://www.hexacorn.com/blog/2023/12/31/1-little-known-secret-of-forfiles-exe/
author: Nasreddine Bencherchali (Nextron Systems), Anish Bogati
date: 2024/01/05
tags:
- attack.defense_evasion
- attack.t1036
logsource:
  category: process_creation
  product: windows
detection:
- and:
  - or:
    - ParentCommandLine|endswith: .exe
    - ParentCommandLine|endswith: .exe"
  - Image|endswith: \cmd.exe
  - CommandLine|startswith: /c echo "
  - ParentImage|not contains: :\Windows\System32\
  - ParentImage|not contains: :\Windows\SysWOW64\
falsepositives:
- Unknown
level: high
