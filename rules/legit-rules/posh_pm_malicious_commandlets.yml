title: Malicious PowerShell Commandlets - PoshModule
id: 7d0d0329-0ef1-4e84-a9f5-49500f9d7c6c
related:
- id: 89819aa4-bbd6-46bc-88ec-c7f7fe30efa6
  type: similar
- id: 02030f2f-6199-49ec-b258-ea71b07e03dc
  type: similar
status: test
description: Detects Commandlet names from well-known PowerShell exploitation frameworks
references:
- https://adsecurity.org/?p=2921
- https://github.com/S3cur3Th1sSh1t/PowerSharpPack/tree/master/PowerSharpBinaries
- https://github.com/BC-SECURITY/Invoke-ZeroLogon/blob/111d17c7fec486d9bb23387e2e828b09a26075e4/Invoke-ZeroLogon.ps1
- https://github.com/xorrior/RandomPS-Scripts/blob/848c919bfce4e2d67b626cbcf4404341cfe3d3b6/Get-DXWebcamVideo.ps1
- https://github.com/rvrsh3ll/Misc-Powershell-Scripts/blob/6f23bb41f9675d7e2d32bacccff75e931ae00554/OfficeMemScraper.ps1
- https://github.com/dafthack/DomainPasswordSpray/blob/b13d64a5834694aa73fd2aea9911a83027c465a7/DomainPasswordSpray.ps1
- https://unit42.paloaltonetworks.com/threat-assessment-black-basta-ransomware/
- https://research.nccgroup.com/2022/06/06/shining-the-light-on-black-basta/
- https://github.com/calebstewart/CVE-2021-1675
- https://github.com/BloodHoundAD/BloodHound/blob/0927441f67161cc6dc08a53c63ceb8e333f55874/Collectors/AzureHound.ps1
- https://bloodhound.readthedocs.io/en/latest/data-collection/azurehound.html
- https://github.com/HarmJ0y/DAMP
- https://github.com/samratashok/nishang
- https://github.com/DarkCoderSc/PowerRunAsSystem/
- https://github.com/besimorhino/powercat
- https://github.com/Kevin-Robertson/Powermad
- https://github.com/adrecon/ADRecon
- https://github.com/adrecon/AzureADRecon
author: Nasreddine Bencherchali (Nextron Systems)
date: 2023/01/20
modified: 2024/01/25
tags:
- attack.execution
- attack.discovery
- attack.t1482
- attack.t1087
- attack.t1087.001
- attack.t1087.002
- attack.t1069.001
- attack.t1069.002
- attack.t1069
- attack.t1059.001
logsource:
  product: windows
  category: ps_module
  definition: 0ad03ef1-f21b-4a79-8ce8-e6900c54b65b
detection:
- and:
  - or:
    - Payload|contains: Add-Exfiltration
    - Payload|contains: Add-Persistence
    - Payload|contains: Add-RegBackdoor
    - Payload|contains: Add-RemoteRegBackdoor
    - Payload|contains: Add-ScrnSaveBackdoor
    - Payload|contains: Check-VM
    - Payload|contains: ConvertTo-Rc4ByteStream
    - Payload|contains: Decrypt-Hash
    - Payload|contains: Disable-ADIDNSNode
    - Payload|contains: Disable-MachineAccount
    - Payload|contains: Do-Exfiltration
    - Payload|contains: Enable-ADIDNSNode
    - Payload|contains: Enable-MachineAccount
    - Payload|contains: Enabled-DuplicateToken
    - Payload|contains: Exploit-Jboss
    - Payload|contains: Export-ADR
    - Payload|contains: Export-ADRCSV
    - Payload|contains: Export-ADRExcel
    - Payload|contains: Export-ADRHTML
    - Payload|contains: Export-ADRJSON
    - Payload|contains: Export-ADRXML
    - Payload|contains: Find-Fruit
    - Payload|contains: Find-GPOLocation
    - Payload|contains: Find-TrustedDocuments
    - Payload|contains: Get-ADIDNS
    - Payload|contains: Get-ApplicationHost
    - Payload|contains: Get-ChromeDump
    - Payload|contains: Get-ClipboardContents
    - Payload|contains: Get-FoxDump
    - Payload|contains: Get-GPPPassword
    - Payload|contains: Get-IndexedItem
    - Payload|contains: Get-KerberosAESKey
    - Payload|contains: Get-Keystrokes
    - Payload|contains: Get-LSASecret
    - Payload|contains: Get-MachineAccountAttribute
    - Payload|contains: Get-MachineAccountCreator
    - Payload|contains: Get-PassHashes
    - Payload|contains: Get-RegAlwaysInstallElevated
    - Payload|contains: Get-RegAutoLogon
    - Payload|contains: Get-RemoteBootKey
    - Payload|contains: Get-RemoteCachedCredential
    - Payload|contains: Get-RemoteLocalAccountHash
    - Payload|contains: Get-RemoteLSAKey
    - Payload|contains: Get-RemoteMachineAccountHash
    - Payload|contains: Get-RemoteNLKMKey
    - Payload|contains: Get-RickAstley
    - Payload|contains: Get-Screenshot
    - Payload|contains: Get-SecurityPackages
    - Payload|contains: Get-ServiceFilePermission
    - Payload|contains: Get-ServicePermission
    - Payload|contains: Get-ServiceUnquoted
    - Payload|contains: Get-SiteListPassword
    - Payload|contains: Get-System
    - Payload|contains: Get-TimedScreenshot
    - Payload|contains: Get-UnattendedInstallFile
    - Payload|contains: Get-Unconstrained
    - Payload|contains: Get-USBKeystrokes
    - Payload|contains: Get-VaultCredential
    - Payload|contains: Get-VulnAutoRun
    - Payload|contains: Get-VulnSchTask
    - Payload|contains: Grant-ADIDNSPermission
    - Payload|contains: Gupt-Backdoor
    - Payload|contains: HTTP-Login
    - Payload|contains: Install-ServiceBinary
    - Payload|contains: Install-SSP
    - Payload|contains: Invoke-ACLScanner
    - Payload|contains: Invoke-ADRecon
    - Payload|contains: Invoke-ADSBackdoor
    - Payload|contains: Invoke-AgentSmith
    - Payload|contains: Invoke-AllChecks
    - Payload|contains: Invoke-ARPScan
    - Payload|contains: Invoke-AzureHound
    - Payload|contains: Invoke-BackdoorLNK
    - Payload|contains: Invoke-BadPotato
    - Payload|contains: Invoke-BetterSafetyKatz
    - Payload|contains: Invoke-BypassUAC
    - Payload|contains: Invoke-Carbuncle
    - Payload|contains: Invoke-Certify
    - Payload|contains: Invoke-ConPtyShell
    - Payload|contains: Invoke-CredentialInjection
    - Payload|contains: Invoke-DAFT
    - Payload|contains: Invoke-DCSync
    - Payload|contains: Invoke-DinvokeKatz
    - Payload|contains: Invoke-DllInjection
    - Payload|contains: Invoke-DNSUpdate
    - Payload|contains: Invoke-DomainPasswordSpray
    - Payload|contains: Invoke-DowngradeAccount
    - Payload|contains: Invoke-EgressCheck
    - Payload|contains: Invoke-Eyewitness
    - Payload|contains: Invoke-FakeLogonScreen
    - Payload|contains: Invoke-Farmer
    - Payload|contains: Invoke-Get-RBCD-Threaded
    - Payload|contains: Invoke-Gopher
    - Payload|contains: Invoke-Grouper
    - Payload|contains: Invoke-HandleKatz
    - Payload|contains: Invoke-ImpersonatedProcess
    - Payload|contains: Invoke-ImpersonateSystem
    - Payload|contains: Invoke-InteractiveSystemPowerShell
    - Payload|contains: Invoke-Internalmonologue
    - Payload|contains: Invoke-Inveigh
    - Payload|contains: Invoke-InveighRelay
    - Payload|contains: Invoke-KrbRelay
    - Payload|contains: Invoke-LdapSignCheck
    - Payload|contains: Invoke-Lockless
    - Payload|contains: Invoke-MalSCCM
    - Payload|contains: Invoke-Mimikatz
    - Payload|contains: Invoke-Mimikittenz
    - Payload|contains: Invoke-MITM6
    - Payload|contains: Invoke-NanoDump
    - Payload|contains: Invoke-NetRipper
    - Payload|contains: Invoke-Nightmare
    - Payload|contains: Invoke-NinjaCopy
    - Payload|contains: Invoke-OfficeScrape
    - Payload|contains: Invoke-OxidResolver
    - Payload|contains: Invoke-P0wnedshell
    - Payload|contains: Invoke-Paranoia
    - Payload|contains: Invoke-PortScan
    - Payload|contains: Invoke-PoshRatHttp
    - Payload|contains: Invoke-PostExfil
    - Payload|contains: Invoke-PowerDump
    - Payload|contains: Invoke-PowerShellTCP
    - Payload|contains: Invoke-PowerShellWMI
    - Payload|contains: Invoke-PPLDump
    - Payload|contains: Invoke-PsExec
    - Payload|contains: Invoke-PSInject
    - Payload|contains: Invoke-PsUaCme
    - Payload|contains: Invoke-ReflectivePEInjection
    - Payload|contains: Invoke-ReverseDNSLookup
    - Payload|contains: Invoke-Rubeus
    - Payload|contains: Invoke-RunAs
    - Payload|contains: Invoke-SafetyKatz
    - Payload|contains: Invoke-SauronEye
    - Payload|contains: Invoke-SCShell
    - Payload|contains: Invoke-Seatbelt
    - Payload|contains: Invoke-ServiceAbuse
    - Payload|contains: Invoke-ShadowSpray
    - Payload|contains: Invoke-Sharp
    - Payload|contains: Invoke-Shellcode
    - Payload|contains: Invoke-SMBScanner
    - Payload|contains: Invoke-Snaffler
    - Payload|contains: Invoke-Spoolsample
    - Payload|contains: Invoke-SpraySinglePassword
    - Payload|contains: Invoke-SSHCommand
    - Payload|contains: Invoke-StandIn
    - Payload|contains: Invoke-StickyNotesExtract
    - Payload|contains: Invoke-SystemCommand
    - Payload|contains: Invoke-Tasksbackdoor
    - Payload|contains: Invoke-Tater
    - Payload|contains: Invoke-Thunderfox
    - Payload|contains: Invoke-ThunderStruck
    - Payload|contains: Invoke-TokenManipulation
    - Payload|contains: Invoke-Tokenvator
    - Payload|contains: Invoke-TotalExec
    - Payload|contains: Invoke-UrbanBishop
    - Payload|contains: Invoke-UserHunter
    - Payload|contains: Invoke-VoiceTroll
    - Payload|contains: Invoke-Whisker
    - Payload|contains: Invoke-WinEnum
    - Payload|contains: Invoke-winPEAS
    - Payload|contains: Invoke-WireTap
    - Payload|contains: Invoke-WmiCommand
    - Payload|contains: Invoke-WMIExec
    - Payload|contains: Invoke-WScriptBypassUAC
    - Payload|contains: Invoke-Zerologon
    - Payload|contains: MailRaider
    - Payload|contains: New-ADIDNSNode
    - Payload|contains: New-DNSRecordArray
    - Payload|contains: New-HoneyHash
    - Payload|contains: New-InMemoryModule
    - Payload|contains: New-MachineAccount
    - Payload|contains: New-SOASerialNumberArray
    - Payload|contains: Out-Minidump
    - Payload|contains: Port-Scan
    - Payload|contains: PowerBreach
    - Payload|contains: 'powercat '
    - Payload|contains: PowerUp
    - Payload|contains: PowerView
    - Payload|contains: Remove-ADIDNSNode
    - Payload|contains: Remove-MachineAccount
    - Payload|contains: Remove-Update
    - Payload|contains: Rename-ADIDNSNode
    - Payload|contains: Revoke-ADIDNSPermission
    - Payload|contains: Set-ADIDNSNode
    - Payload|contains: Set-MacAttribute
    - Payload|contains: Set-MachineAccountAttribute
    - Payload|contains: Set-Wallpaper
    - Payload|contains: Show-TargetScreen
    - Payload|contains: Start-CaptureServer
    - Payload|contains: Start-Dnscat2
    - Payload|contains: Start-WebcamRecorder
    - Payload|contains: VolumeShadowCopyTools
falsepositives:
- Unknown
level: high
