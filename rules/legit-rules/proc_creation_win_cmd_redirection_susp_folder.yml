title: Potentially Suspicious CMD Shell Output Redirect
id: 8e0bb260-d4b2-4fff-bb8d-3f82118e6892
related:
- id: aa2efee7-34dd-446e-8a37-40790a66efd7
  type: derived
- id: 4f4eaa9f-5ad4-410c-a4be-bc6132b0175a
  type: similar
status: experimental
description: 'Detects inline Windows shell commands redirecting output via the ">"
  symbol to a suspicious location.

  This technique is sometimes used by malicious actors in order to redirect the output
  of reconnaissance commands such as "hostname" and "dir" to files for future exfiltration.

  '
references:
- https://thedfirreport.com/2022/07/11/select-xmrig-from-sqlserver/
author: Nasreddine Bencherchali (Nextron Systems)
date: 2022/07/12
modified: 2024/03/19
tags:
- attack.defense_evasion
- attack.t1218
logsource:
  category: process_creation
  product: windows
detection:
- and:
  - or:
    - Image|endswith: \cmd.exe
    - OriginalFileName|==: Cmd.Exe
  - or:
    - CommandLine|contains: '>?%APPDATA%\'
    - CommandLine|contains: '>?%TEMP%\'
    - CommandLine|contains: '>?%TMP%\'
    - CommandLine|contains: '>?%USERPROFILE%\'
    - CommandLine|contains: '>?C:\ProgramData\'
    - CommandLine|contains: '>?C:\Temp\'
    - CommandLine|contains: '>?C:\Users\Public\'
    - CommandLine|contains: '>?C:\Windows\Temp\'
  - or:
    - CommandLine|contains: ' >'
    - CommandLine|contains: '">'
    - CommandLine|contains: '''>'
  - CommandLine|contains: C:\Users\
  - CommandLine|contains: \AppData\Local\
falsepositives:
- Legitimate admin or third party scripts used for diagnostic collection might generate
  some false positives
level: medium
