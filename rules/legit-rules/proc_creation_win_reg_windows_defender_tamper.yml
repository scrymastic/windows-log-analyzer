title: Suspicious Windows Defender Registry Key Tampering Via Reg.EXE
id: 452bce90-6fb0-43cc-97a5-affc283139b3
status: test
description: Detects the usage of "reg.exe" to tamper with different Windows Defender
  registry keys in order to disable some important features related to protection
  and detection
references:
- https://thedfirreport.com/2022/03/21/apt35-automates-initial-access-using-proxyshell/
- https://github.com/swagkarna/Defeat-Defender-V1.2.0
- https://www.elevenforum.com/t/video-guide-how-to-completely-disable-microsoft-defender-antivirus.14608/page-2
author: Florian Roth (Nextron Systems), Swachchhanda Shrawan Poudel, Nasreddine Bencherchali
  (Nextron Systems)
date: 2022/03/22
modified: 2023/06/05
tags:
- attack.defense_evasion
- attack.t1562.001
logsource:
  category: process_creation
  product: windows
detection:
- and:
  - or:
    - Image|endswith: \reg.exe
    - OriginalFileName|==: reg.exe
  - or:
    - CommandLine|contains: SOFTWARE\Microsoft\Windows Defender\
    - CommandLine|contains: SOFTWARE\Policies\Microsoft\Windows Defender Security
        Center
    - CommandLine|contains: SOFTWARE\Policies\Microsoft\Windows Defender\
  - CommandLine|contains: ' add '
  - CommandLine|contains: d 0
  - or:
    - CommandLine|contains: DisallowExploitProtectionOverride
    - CommandLine|contains: EnableControlledFolderAccess
    - CommandLine|contains: MpEnablePus
    - CommandLine|contains: PUAProtection
    - CommandLine|contains: SpynetReporting
    - CommandLine|contains: SubmitSamplesConsent
    - CommandLine|contains: TamperProtection
  - CommandLine|contains: ' add '
  - CommandLine|contains: d 1
  - or:
    - CommandLine|contains: DisableAntiSpyware
    - CommandLine|contains: DisableAntiSpywareRealtimeProtection
    - CommandLine|contains: DisableAntiVirus
    - CommandLine|contains: DisableArchiveScanning
    - CommandLine|contains: DisableBehaviorMonitoring
    - CommandLine|contains: DisableBlockAtFirstSeen
    - CommandLine|contains: DisableConfig
    - CommandLine|contains: DisableEnhancedNotifications
    - CommandLine|contains: DisableIntrusionPreventionSystem
    - CommandLine|contains: DisableIOAVProtection
    - CommandLine|contains: DisableOnAccessProtection
    - CommandLine|contains: DisablePrivacyMode
    - CommandLine|contains: DisableRealtimeMonitoring
    - CommandLine|contains: DisableRoutinelyTakingAction
    - CommandLine|contains: DisableScanOnRealtimeEnable
    - CommandLine|contains: DisableScriptScanning
    - CommandLine|contains: Notification_Suppress
    - CommandLine|contains: SignatureDisableUpdateOnStartupWithoutEngine
falsepositives:
- Rare legitimate use by administrators to test software (should always be investigated)
level: high
