title: Suspicious AddinUtil.EXE CommandLine Execution
id: 631b22a4-70f4-4e2f-9ea8-42f84d9df6d8
status: experimental
description: 'Detects execution of the Add-In deployment cache updating utility (AddInutil.exe)
  with suspicious Addinroot or Pipelineroot paths. An adversary may execute AddinUtil.exe
  with uncommon Addinroot/Pipelineroot paths that point to the adversaries Addins.Store
  payload.

  '
references:
- https://www.blue-prints.blog/content/blog/posts/lolbin/addinutil-lolbas.html
author: Nasreddine Bencherchali (Nextron Systems), Michael McKinley (@McKinleyMike),
  Tony Latteri (@TheLatteri)
date: 2023/09/18
tags:
- attack.defense_evasion
- attack.t1218
logsource:
  category: process_creation
  product: windows
detection:
- selection_img:
  - and:
    - or:
      - Image|endswith: \addinutil.exe
      - OriginalFileName|==: AddInUtil.exe
- selection_susp_1_flags:
  - and:
    - or:
      - CommandLine|contains: '-AddInRoot:'
      - CommandLine|contains: '-PipelineRoot:'
- selection_susp_1_paths:
  - and:
    - or:
      - CommandLine|contains: \AppData\Local\Temp\
      - CommandLine|contains: \Desktop\
      - CommandLine|contains: \Downloads\
      - CommandLine|contains: \Users\Public\
      - CommandLine|contains: \Windows\Temp\
- selection_susp_2:
  - and:
    - or:
      - CommandLine|contains: -AddInRoot:.
      - CommandLine|contains: -AddInRoot:"."
      - CommandLine|contains: -PipelineRoot:.
      - CommandLine|contains: -PipelineRoot:"."
    - or:
      - CurrentDirectory|contains: \AppData\Local\Temp\
      - CurrentDirectory|contains: \Desktop\
      - CurrentDirectory|contains: \Downloads\
      - CurrentDirectory|contains: \Users\Public\
      - CurrentDirectory|contains: \Windows\Temp\
- condition: selection_img and (all of selection_susp_1_* or selection_susp_2)
falsepositives:
- Unknown
level: high
