title: Schtasks Creation Or Modification With SYSTEM Privileges
id: 89ca78fd-b37c-4310-b3d3-81a023f83936
status: experimental
description: Detects the creation or update of a scheduled task to run with "NT AUTHORITY\SYSTEM"
  privileges
references:
- https://www.elastic.co/security-labs/exploring-the-qbot-attack-pattern
- https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/schtasks
author: Nasreddine Bencherchali (Nextron Systems)
date: 2022/07/28
modified: 2023/10/11
tags:
- attack.execution
- attack.persistence
- attack.t1053.005
logsource:
  product: windows
  category: process_creation
detection:
- selection_root:
  - and:
    - Image|endswith: \schtasks.exe
    - or:
      - CommandLine|contains: ' /change '
      - CommandLine|contains: ' /create '
- selection_run:
  - and:
    - CommandLine|contains: '/ru '
- selection_user:
  - and:
    - or:
      - CommandLine|contains: NT AUT
      - CommandLine|contains: ' SYSTEM '
- filter_optional_teamviewer:
  - and:
    - Image|endswith: \schtasks.exe
    - CommandLine|contains: /TN TVInstallRestore
    - CommandLine|contains: \TeamViewer_.exe
- filter_optional_avira:
  - and:
    - or:
      - CommandLine|contains: '/Create /F /RU System /SC WEEKLY /TN AviraSystemSpeedupVerify
          /TR '
      - CommandLine|contains: :\Program Files (x86)\Avira\System Speedup\setup\avira_speedup_setup.exe
      - CommandLine|contains: /VERIFY /VERYSILENT /NOSTART /NODOTNET /NORESTART" /RL
          HIGHEST
- condition: all of selection_* and not 1 of filter_optional_*
falsepositives:
- Unknown
level: high
