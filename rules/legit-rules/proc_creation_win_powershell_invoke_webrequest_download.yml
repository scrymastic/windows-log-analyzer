title: Suspicious Invoke-WebRequest Execution
id: 5e3cc4d8-3e68-43db-8656-eaaeefdec9cc
related:
- id: e218595b-bbe7-4ee5-8a96-f32a24ad3468
  type: derived
status: experimental
description: Detects a suspicious call to Invoke-WebRequest cmdlet where the and output
  is located in a suspicious location
references:
- https://www.sentinelone.com/blog/living-off-windows-defender-lockbit-ransomware-sideloads-cobalt-strike-through-microsoft-security-tool/
author: Nasreddine Bencherchali (Nextron Systems)
date: 2022/08/02
modified: 2024/02/23
tags:
- attack.command_and_control
- attack.t1105
logsource:
  category: process_creation
  product: windows
detection:
- and:
  - or:
    - or:
      - Image|endswith: \powershell.exe
      - Image|endswith: \pwsh.exe
    - or:
      - OriginalFileName|==: PowerShell.EXE
      - OriginalFileName|==: pwsh.dll
  - or:
    - CommandLine|contains: 'curl '
    - CommandLine|contains: Invoke-WebRequest
    - CommandLine|contains: 'iwr '
    - CommandLine|contains: 'wget '
  - or:
    - CommandLine|contains: ' -ur'
    - CommandLine|contains: ' -o'
  - or:
    - CommandLine|contains: \AppData\
    - CommandLine|contains: \Desktop\
    - CommandLine|contains: \Temp\
    - CommandLine|contains: \Users\Public\
    - CommandLine|contains: '%AppData%'
    - CommandLine|contains: '%Public%'
    - CommandLine|contains: '%Temp%'
    - CommandLine|contains: '%tmp%'
    - CommandLine|contains: :\Windows\
falsepositives:
- Unknown
level: high
